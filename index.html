<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buyzo Cart — Admin Panel</title>
  <meta name="description" content="Admin panel for Buyzo Cart — manage products, orders, and settings."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <!-- Firebase Database -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <!-- Firebase Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --muted: #64748b;
      --muted-light: #94a3b8;
      --success: #22c55e;
      --error: #ef4444;
      --warning: #f59e0b;
      --purple: #8b5cf6;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.08);
      --ring: #dbeafe;
      --ink: #0f172a;
      --ink-2: #334155;
      --border: #e2e8f0;
      --radius: 12px;
      --sidebar-width: 260px;
      --header-height: 70px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Admin Layout */
    .admin-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .admin-sidebar {
      width: var(--sidebar-width);
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .admin-brand {
      padding: 0 24px 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
    }

    .admin-brand h1 {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
    }

    .admin-brand .chip {
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
    }

    .admin-nav {
      list-style: none;
      padding: 0;
    }

    .admin-nav li {
      margin-bottom: 4px;
    }

    .admin-nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      color: var(--muted);
      transition: all 0.2s ease;
    }

    .admin-nav a:hover, .admin-nav a.active {
      background: #f1f5f9;
      color: var(--accent);
    }

    .admin-nav a i {
      width: 20px;
      text-align: center;
    }

    /* Sidebar close button for mobile */
    .sidebar-close {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      color: var(--muted);
      cursor: pointer;
    }

    /* Main Content */
    .admin-main {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 20px;
    }

    .admin-header {
      background: var(--card);
      padding: 16px 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .admin-title {
      font-size: 24px;
      font-weight: 700;
    }

    .admin-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .admin-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    /* Dashboard Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      font-size: 20px;
    }

    .stat-icon.blue {
      background: #dbeafe;
      color: var(--accent);
    }

    .stat-icon.green {
      background: #dcfce7;
      color: var(--success);
    }

    .stat-icon.orange {
      background: #fed7aa;
      color: var(--warning);
    }

    .stat-icon.red {
      background: #fee2e2;
      color: var(--error);
    }

    .stat-icon.purple {
      background: #ede9fe;
      color: var(--purple);
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--muted);
      font-size: 14px;
    }

    /* Content Cards */
    .content-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
    }

    /* Tables */
    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }

    .admin-table th,
    .admin-table td {
      padding: 12px 16px;
      text-align: left;
    }

    .admin-table th {
      background: #f8fafc;
      font-weight: 600;
      color: var(--muted);
      font-size: 14px;
    }

    .admin-table tr {
      border-bottom: 1px solid var(--border);
    }

    .admin-table tr:last-child {
      border-bottom: none;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: #fff;
      outline: none;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      box-shadow: 0 0 0 3px var(--ring);
      border-color: var(--accent);
    }

    .form-row {
      display: flex;
      gap: 16px;
    }

    .form-col {
      flex: 1;
    }

    /* Buttons */
    .btn {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn.secondary {
      background: #f1f5f9;
      color: var(--ink-2);
    }

    .btn.secondary:hover {
      background: #e2e8f0;
    }

    .btn.success {
      background: var(--success);
    }

    .btn.success:hover {
      background: #16a34a;
    }

    .btn.error {
      background: var(--error);
    }

    .btn.error:hover {
      background: #dc2626;
    }

    .btn.warning {
      background: var(--warning);
    }

    .btn.warning:hover {
      background: #d97706;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background: #dcfce7;
      color: #166534;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-error {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }

    /* Tabs */
    .admin-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 16px;
    }

    .tab {
      padding: 8px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 500;
      color: var(--muted);
      transition: all 0.2s ease;
    }

    .tab.active {
      background: var(--accent);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Image Upload */
    .image-upload {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .image-upload:hover {
      border-color: var(--accent);
    }

    .upload-icon {
      font-size: 32px;
      color: var(--muted-light);
      margin-bottom: 8px;
    }

    .image-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    .preview-item {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-image {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--error);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
    }

    /* Login Page */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f1f5f9;
    }

    .login-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow-hover);
      width: 100%;
      max-width: 400px;
    }

    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .login-subtitle {
      color: var(--muted);
      margin-bottom: 24px;
    }

    /* Earnings Section */
    .earnings-section {
      margin-bottom: 24px;
    }

    .earnings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .earnings-title {
      font-size: 18px;
      font-weight: 600;
    }

    .earnings-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .earnings-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .earnings-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .earnings-label {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 12px;
    }

    .earnings-comparison {
      display: flex;
      align-items: center;
      font-size: 14px;
    }

    .earnings-trend {
      display: flex;
      align-items: center;
      margin-right: 8px;
    }

    .trend-up {
      color: var(--success);
    }

    .trend-down {
      color: var(--error);
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .admin-sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      
      .admin-sidebar.active {
        transform: translateX(0);
      }
      
      .admin-main {
        margin-left: 0;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .sidebar-close {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .admin-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .admin-table {
        display: block;
        overflow-x: auto;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .earnings-cards {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .admin-main {
        padding: 16px;
      }
      
      .content-card {
        padding: 16px;
      }
    }

    /* Toggle for mobile */
    .menu-toggle {
      display: none;
      background: var(--accent);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: var(--radius);
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
    }

    @media (max-width: 1024px) {
      .menu-toggle {
        display: flex;
      }
    }

    /* Checkbox */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group input {
      width: auto;
    }

    /* Search and filters */
    .table-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .search-box {
      position: relative;
      flex: 1;
      min-width: 250px;
    }

    .search-box input {
      padding-left: 40px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted-light);
    }

    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Action buttons */
    .action-buttons {
      display: flex;
      gap: 8px;
    }

    /* Pagination */
    .pagination {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 24px;
    }

    .page-item {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      background: #f1f5f9;
      color: var(--ink);
      font-weight: 500;
      cursor: pointer;
    }

    .page-item.active {
      background: var(--accent);
      color: white;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .admin-modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-hover);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--muted);
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <!-- Admin Login Page -->
  <div id="adminLoginPage" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <h1 class="login-title">Buyzo Cart</h1>
        <p class="login-subtitle">Admin Panel Login</p>
      </div>
      
      <div class="form-group">
        <label for="adminEmail">Email</label>
        <input type="email" id="adminEmail" placeholder="admin@example.com">
      </div>
      
      <div class="form-group">
        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" placeholder="Enter your password">
      </div>
      
      <button class="btn" style="width: 100%" onclick="adminLogin()">Login</button>
    </div>
  </div>

  <!-- Admin Panel (initially hidden) -->
  <div id="adminPanel" style="display: none">
    <div class="admin-container">
      <!-- Sidebar -->
      <div class="admin-sidebar" id="adminSidebar">
        <div class="admin-brand">
          <div class="chip">BUYZO</div>
          <h1>Admin Panel</h1>
          <button class="sidebar-close" onclick="toggleSidebar()">&times;</button>
        </div>
        
        <ul class="admin-nav">
          <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
          <li><a href="#" data-tab="products"><i class="fas fa-box"></i> Products</a></li>
          <li><a href="#" data-tab="orders"><i class="fas fa-shopping-cart"></i> Orders</a></li>
          <li><a href="#" data-tab="trending"><i class="fas fa-fire"></i> Trending Products</a></li>
          <li><a href="#" data-tab="customers"><i class="fas fa-users"></i> Customers</a></li>
          <li><a href="#" data-tab="policies"><i class="fas fa-file-alt"></i> Policies</a></li>
          <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </div>
      
      <!-- Main Content -->
      <div class="admin-main">
        <div class="admin-header">
          <div>
            <button class="menu-toggle" onclick="toggleSidebar()">
              <i class="fas fa-bars"></i>
            </button>
            <h1 class="admin-title" id="adminPageTitle">Dashboard</h1>
          </div>
          
          <div class="admin-user">
            <div class="admin-avatar">A</div>
            <div>
              <div style="font-weight: 600">Admin User</div>
              <div style="font-size: 14px; color: var(--muted)">Super Admin</div>
            </div>
          </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon blue">
                <i class="fas fa-box"></i>
              </div>
              <div class="stat-value" id="totalProducts">0</div>
              <div class="stat-label">Total Products</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon green">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <div class="stat-value" id="totalOrders">0</div>
              <div class="stat-label">Total Orders</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon orange">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-value" id="pendingOrders">0</div>
              <div class="stat-label">Pending Orders</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon red">
                <i class="fas fa-fire"></i>
              </div>
              <div class="stat-value" id="trendingProducts">0</div>
              <div class="stat-label">Trending Products</div>
            </div>
          </div>

          <!-- Earnings Section -->
          <div class="earnings-section">
            <div class="earnings-header">
              <h2 class="earnings-title">Revenue & Earnings</h2>
            </div>
            <div class="earnings-cards">
              <div class="earnings-card">
                <div class="earnings-value" id="totalEarnings">₹0</div>
                <div class="earnings-label">Total Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="totalEarningsTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs lifetime</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastWeekEarnings">₹0</div>
                <div class="earnings-label">Last Week Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastWeekTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous week</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastMonthEarnings">₹0</div>
                <div class="earnings-label">Last Month Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastMonthTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous month</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="content-card">
            <div class="card-header">
              <h2 class="card-title">Recent Orders</h2>
              <a href="#" onclick="showTab('orders'); return false;" class="btn secondary btn-sm">View All</a>
            </div>
            
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Product</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="recentOrders">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Products Tab -->
        <div class="tab-content" id="products">
          <div class="card-header">
            <h2 class="card-title">Product Management</h2>
            <button class="btn" onclick="showAddProductModal()"><i class="fas fa-plus"></i> Add Product</button>
          </div>
          
          <div class="table-controls">
            <div class="search-box">
              <i class="fas fa-search search-icon"></i>
              <input type="text" placeholder="Search products..." id="productSearch">
            </div>
            
            <div class="filters">
              <select id="categoryFilter">
                <option value="">All Categories</option>
                <option value="Topwear">Topwear</option>
                <option value="Sarees">Sarees</option>
                <option value="Bottomwear">Bottomwear</option>
                <option value="Watches">Watches</option>
                <option value="Backt">Backt</option>
                <option value="Kurta Sets">Kurta Sets</option>
                <option value="Winter Wear">Winter Wear</option>
                <option value="Casual shoes">Casual shoes</option>
                <option value="Trolley Bags">Trolley Bags</option>
                <option value="Men's Acc">Men's Acc</option>
                <option value="Bottor">Bottor</option>
              </select>
            </div>
          </div>
          
          <div class="content-card">
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Trending</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="productsTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            
            <div class="pagination" id="productsPagination">
              <!-- Pagination will be added here -->
            </div>
          </div>
        </div>
        
        <!-- Orders Tab -->
        <div class="tab-content" id="orders">
          <div class="card-header">
            <h2 class="card-title">Order Management</h2>
            <button class="btn secondary" onclick="exportOrders()"><i class="fas fa-download"></i> Export</button>
          </div>
          
          <div class="table-controls">
            <div class="search-box">
              <i class="fas fa-search search-icon"></i>
              <input type="text" placeholder="Search orders..." id="orderSearch">
            </div>
            
            <div class="filters">
              <select id="statusFilter">
                <option value="">All Status</option>
                <option value="Pending">Pending</option>
                <option value="Confirmed">Confirmed</option>
                <option value="Shipped">Shipped</option>
                <option value="Delivered">Delivered</option>
                <option value="Cancelled">Cancelled</option>
              </select>
              
              <input type="date" id="dateFilter">
            </div>
          </div>
          
          <div class="content-card">
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="selectAllOrders"></th>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Product</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ordersTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            
            <div style="margin-top: 16px">
              <select id="bulkStatusAction" style="width: auto; margin-right: 12px">
                <option value="">Bulk Action</option>
                <option value="Confirmed">Mark as Confirmed</option>
                <option value="Shipped">Mark as Shipped</option>
                <option value="Delivered">Mark as Delivered</option>
                <option value="Cancelled">Mark as Cancelled</option>
              </select>
              <button class="btn" onclick="applyBulkAction()">Apply</button>
            </div>
            
            <div class="pagination" id="ordersPagination">
              <!-- Pagination will be added here -->
            </div>
          </div>
        </div>
        
        <!-- Trending Tab -->
        <div class="tab-content" id="trending">
          <div class="card-header">
            <h2 class="card-title">Trending Products Control</h2>
          </div>
          
          <div class="content-card">
            <p style="margin-bottom: 16px">Select products to feature in the "Trending Now" section on the website.</p>
            
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Trending</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="trendingTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Customers Tab -->
        <div class="tab-content" id="customers">
          <div class="card-header">
            <h2 class="card-title">Customer Data</h2>
            <button class="btn secondary" onclick="exportCustomers()"><i class="fas fa-download"></i> Export CSV</button>
          </div>
          
          <div class="table-controls">
            <div class="search-box">
              <i class="fas fa-search search-icon"></i>
              <input type="text" placeholder="Search customers..." id="customerSearch">
            </div>
          </div>
          
          <div class="content-card">
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Mobile</th>
                    <th>Email</th>
                    <th>Location</th>
                    <th>Orders</th>
                    <th>Last Order</th>
                  </tr>
                </thead>
                <tbody id="customersTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            
            <div class="pagination" id="customersPagination">
              <!-- Pagination will be added here -->
            </div>
          </div>
        </div>
        
        <!-- Policies Tab -->
        <div class="tab-content" id="policies">
          <div class="admin-tabs">
            <div class="tab active" data-policy="about">About Us</div>
            <div class="tab" data-policy="refund">Refund Policy</div>
            <div class="tab" data-policy="terms">Terms & Conditions</div>
            <div class="tab" data-policy="shipping">Shipping Policy</div>
            <div class="tab" data-policy="privacy">Privacy Policy</div>
          </div>
          
          <div class="content-card">
            <div class="policy-content active" data-policy="about">
              <h3>About Us Page Content</h3>
              <textarea id="aboutContent" rows="10" style="width: 100%; margin-top: 16px"></textarea>
              <button class="btn" style="margin-top: 16px" onclick="savePolicy('about')">Save Changes</button>
            </div>
            
            <div class="policy-content" data-policy="refund">
              <h3>Refund Policy Content</h3>
              <textarea id="refundContent" rows="10" style="width: 100%; margin-top: 16px"></textarea>
              <button class="btn" style="margin-top: 16px" onclick="savePolicy('refund')">Save Changes</button>
            </div>
            
            <div class="policy-content" data-policy="terms">
              <h3>Terms & Conditions Content</h3>
              <textarea id="termsContent" rows="10" style="width: 100%; margin-top: 16px"></textarea>
              <button class="btn" style="margin-top: 16px" onclick="savePolicy('terms')">Save Changes</button>
            </div>
            
            <div class="policy-content" data-policy="shipping">
              <h3>Shipping Policy Content</h3>
              <textarea id="shippingContent" rows="10" style="width: 100%; margin-top: 16px"></textarea>
              <button class="btn" style="margin-top: 16px" onclick="savePolicy('shipping')">Save Changes</button>
            </div>
            
            <div class="policy-content" data-policy="privacy">
              <h3>Privacy Policy Content</h3>
              <textarea id="privacyContent" rows="10" style="width: 100%; margin-top: 16px"></textarea>
              <button class="btn" style="margin-top: 16px" onclick="savePolicy('privacy')">Save Changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div class="modal-overlay" id="addProductModal">
    <div class="admin-modal">
      <div class="modal-header">
        <h2 class="modal-title">Add New Product</h2>
        <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
      </div>
      
      <div class="form-group">
        <label for="productName">Product Name</label>
        <input type="text" id="productName" placeholder="Enter product name">
      </div>
      
      <div class="form-group">
        <label for="productPrice">Price (₹)</label>
        <input type="number" id="productPrice" placeholder="Enter price">
      </div>
      
      <div class="form-group">
        <label for="productCategory">Category</label>
        <input list="categoryOptions" id="productCategory" placeholder="Select or type category">
        <datalist id="categoryOptions">
          <option value="Topwear">
          <option value="Sarees">
          <option value="Bottomwear">
          <option value="Watches">
          <option value="Backt">
          <option value="Kurta Sets">
          <option value="Winter Wear">
          <option value="Casual shoes">
          <option value="Trolley Bags">
          <option value="Men's Acc">
          <option value="Bottor">
        </datalist>
      </div>
      
      <div class="form-group">
        <label for="productDesc">Short Description</label>
        <input type="text" id="productDesc" placeholder="Enter short description">
      </div>
      
      <div class="form-group">
        <label for="productFullDesc">Full Description</label>
        <textarea id="productFullDesc" placeholder="Enter full description"></textarea>
      </div>
      
      <div class="form-group">
        <label>Sizes (comma separated)</label>
        <input type="text" id="productSizes" placeholder="S, M, L, XL">
      </div>
      
      <div class="form-group">
        <label>Product Images</label>
        <div class="image-upload" onclick="document.getElementById('productImages').click()">
          <div class="upload-icon">
            <i class="fas fa-cloud-upload-alt"></i>
          </div>
          <p>Click to upload images</p>
          <input type="file" id="productImages" multiple style="display: none" onchange="handleImageUpload(this)">
        </div>
        
        <div class="image-preview" id="imagePreview">
          <!-- Image previews will be added here -->
        </div>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="productTrending">
        <label for="productTrending">Mark as Trending Product</label>
      </div>
      
      <div class="modal-actions">
        <button class="btn secondary" onclick="closeModal('addProductModal')">Cancel</button>
        <button class="btn" onclick="saveProduct()">Save Product</button>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal-overlay" id="editProductModal">
    <div class="admin-modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit Product</h2>
        <button class="modal-close" onclick="closeModal('editProductModal')">&times;</button>
      </div>
      
      <input type="hidden" id="editProductId">
      
      <div class="form-group">
        <label for="editProductName">Product Name</label>
        <input type="text" id="editProductName" placeholder="Enter product name">
      </div>
      
      <div class="form-group">
        <label for="editProductPrice">Price (₹)</label>
        <input type="number" id="editProductPrice" placeholder="Enter price">
      </div>
      
      <div class="form-group">
        <label for="editProductCategory">Category</label>
        <select id="editProductCategory">
          <option value="">Select Category</option>
          <option value="Topwear">Topwear</option>
          <option value="Sarees">Sarees</option>
          <option value="Bottomwear">Bottomwear</option>
          <option value="Watches">Watches</option>
          <option value="Backt">Backt</option>
          <option value="Kurta Sets">Kurta Sets</option>
          <option value="Winter Wear">Winter Wear</option>
          <option value="Casual shoes">Casual shoes</option>
          <option value="Trolley Bags">Trolley Bags</option>
          <option value="Men's Acc">Men's Acc</option>
          <option value="Bottor">Bottor</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="editProductDesc">Short Description</label>
        <input type="text" id="editProductDesc" placeholder="Enter short description">
      </div>
      
      <div class="form-group">
        <label for="editProductFullDesc">Full Description</label>
        <textarea id="editProductFullDesc" placeholder="Enter full description"></textarea>
      </div>
      
      <div class="form-group">
        <label>Sizes (comma separated)</label>
        <input type="text" id="editProductSizes" placeholder="S, M, L, XL">
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="editProductTrending">
        <label for="editProductTrending">Mark as Trending Product</label>
      </div>
      
      <div class="modal-actions">
        <button class="btn error" onclick="deleteProduct()">Delete Product</button>
        <button class="btn" onclick="updateProduct()">Update Product</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration and initialization
    const firebaseConfig = {
      apiKey: "AIzaSyAMDAW2Gvsh8qJY5gZoFvgiMHxO5qjQl-I",
      authDomain: "videoapp-67c32.firebaseapp.com",
      databaseURL: "https://videoapp-67c32-default-rtdb.firebaseio.com",
      projectId: "videoapp-67c32",
      storageBucket: "videoapp-67c32.firebasestorage.app",
      messagingSenderId: "711675594877",
      appId: "1:711675594877:web:7786ab4a432d60e6f70914"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Admin State
    let currentAdminTab = 'dashboard';
    let currentProductsPage = 1;
    let currentOrdersPage = 1;
    let currentCustomersPage = 1;
    let productsPerPage = 10;
    let ordersPerPage = 10;
    let customersPerPage = 10;
    let uploadedImages = [];

    // Firebase Data References
    const productsRef = database.ref('buyzo/products');
    const ordersRef = database.ref('buyzo/orders');
    const policiesRef = database.ref('buyzo/policies');

    // Initialize admin panel
    function initAdminPanel() {
      // Check if user is logged in
      const isLoggedIn = localStorage.getItem('admin_logged_in') === 'true';
      
      if (isLoggedIn) {
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
        loadProducts();
        loadOrders();
        loadTrendingProducts();
        loadCustomers();
        loadPolicies();
      } else {
        document.getElementById('adminLoginPage').style.display = 'flex';
        document.getElementById('adminPanel').style.display = 'none';
      }
      
      // Setup tab navigation
      document.querySelectorAll('.admin-nav a').forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          if (this.dataset.tab) {
            showTab(this.dataset.tab);
          }
        });
      });
      
      // Setup policy tabs
      document.querySelectorAll('.admin-tabs .tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const policy = this.dataset.policy;
          showPolicyTab(policy);
        });
      });
      
      // Setup search and filters
      document.getElementById('productSearch').addEventListener('input', filterProducts);
      document.getElementById('categoryFilter').addEventListener('change', filterProducts);
      document.getElementById('orderSearch').addEventListener('input', filterOrders);
      document.getElementById('statusFilter').addEventListener('change', filterOrders);
      document.getElementById('dateFilter').addEventListener('change', filterOrders);
      document.getElementById('customerSearch').addEventListener('input', filterCustomers);
      
      // Select all orders checkbox
      document.getElementById('selectAllOrders').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#ordersTable input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });
    }

    // Admin login function
    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      
      // Simple validation - in a real app, this would call Firebase Auth
      if (email === 'admin@buyzo.com' && password === 'admin123') {
        localStorage.setItem('admin_logged_in', 'true');
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
      } else {
        alert('Invalid credentials. Try admin@buyzo.com / admin123');
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('admin_logged_in');
      document.getElementById('adminLoginPage').style.display = 'flex';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('adminSidebar').classList.toggle('active');
    }

    // Show specific tab
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all nav items
      document.querySelectorAll('.admin-nav a').forEach(nav => {
        nav.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      
      // Set active nav item
      document.querySelector(`.admin-nav a[data-tab="${tabName}"]`).classList.add('active');
      
      // Update page title
      document.getElementById('adminPageTitle').textContent = 
        tabName.charAt(0).toUpperCase() + tabName.slice(1);
      
      currentAdminTab = tabName;
      
      // Load data if needed
      if (tabName === 'dashboard') {
        loadDashboardData();
      } else if (tabName === 'products') {
        loadProducts();
      } else if (tabName === 'orders') {
        loadOrders();
      } else if (tabName === 'trending') {
        loadTrendingProducts();
      } else if (tabName === 'customers') {
        loadCustomers();
      } else if (tabName === 'policies') {
        loadPolicies();
      }
    }

    // Show policy tab
    function showPolicyTab(policy) {
      // Remove active class from all policy tabs
      document.querySelectorAll('.admin-tabs .tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Hide all policy contents
      document.querySelectorAll('.policy-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Activate selected tab and content
      document.querySelector(`.tab[data-policy="${policy}"]`).classList.add('active');
      document.querySelector(`.policy-content[data-policy="${policy}"]`).classList.add('active');
    }

    // Calculate earnings data
    function calculateEarnings(orders, products) {
      const now = new Date();
      const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
      const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      const twoMonthsAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);
      
      let totalEarnings = 0;
      let lastWeekEarnings = 0;
      let previousWeekEarnings = 0;
      let lastMonthEarnings = 0;
      let previousMonthEarnings = 0;
      
      orders.forEach(order => {
        const product = products.find(p => p.id === order.productId);
        if (product) {
          const orderValue = product.price * order.qty;
          const orderDate = new Date(order.timestamp);
          
          totalEarnings += orderValue;
          
          // Last week earnings (last 7 days)
          if (orderDate >= oneWeekAgo) {
            lastWeekEarnings += orderValue;
          }
          
          // Previous week earnings (7-14 days ago)
          if (orderDate >= twoWeeksAgo && orderDate < oneWeekAgo) {
            previousWeekEarnings += orderValue;
          }
          
          // Last month earnings (last 30 days)
          if (orderDate >= oneMonthAgo) {
            lastMonthEarnings += orderValue;
          }
          
          // Previous month earnings (30-60 days ago)
          if (orderDate >= twoMonthsAgo && orderDate < oneMonthAgo) {
            previousMonthEarnings += orderValue;
          }
        }
      });
      
      // Calculate trends
      const weeklyTrend = previousWeekEarnings > 0 
        ? ((lastWeekEarnings - previousWeekEarnings) / previousWeekEarnings) * 100 
        : lastWeekEarnings > 0 ? 100 : 0;
        
      const monthlyTrend = previousMonthEarnings > 0 
        ? ((lastMonthEarnings - previousMonthEarnings) / previousMonthEarnings) * 100 
        : lastMonthEarnings > 0 ? 100 : 0;
      
      return {
        totalEarnings,
        lastWeekEarnings,
        lastMonthEarnings,
        weeklyTrend,
        monthlyTrend
      };
    }

    // Load dashboard data
    function loadDashboardData() {
      // Load products and orders from Firebase
      Promise.all([
        new Promise(resolve => {
          productsRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        }),
        new Promise(resolve => {
          ordersRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        })
      ]).then(([productsData, ordersData]) => {
        // Convert objects to arrays
        const products = Object.values(productsData);
        const orders = Object.values(ordersData);
        const trendingProducts = products.filter(p => p.trending);
        
        // Update stats
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('totalOrders').textContent = orders.length;
        document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'Pending').length;
        document.getElementById('trendingProducts').textContent = trendingProducts.length;
        
        // Calculate and update earnings
        const earnings = calculateEarnings(orders, products);
        document.getElementById('totalEarnings').textContent = `₹${earnings.totalEarnings.toLocaleString()}`;
        document.getElementById('lastWeekEarnings').textContent = `₹${earnings.lastWeekEarnings.toLocaleString()}`;
        document.getElementById('lastMonthEarnings').textContent = `₹${earnings.lastMonthEarnings.toLocaleString()}`;
        
        // Update trends
        updateTrendElement('lastWeekTrend', earnings.weeklyTrend);
        updateTrendElement('lastMonthTrend', earnings.monthlyTrend);
        
        // Load recent orders
        const recentOrders = orders.slice(-5).reverse();
        const recentOrdersHtml = recentOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname}</td>
              <td>${product ? product.title : 'Unknown Product'}</td>
              <td>₹${product ? product.price * order.qty : 'N/A'}</td>
              <td><span class="badge ${getStatusBadgeClass(order.status)}">${order.status || 'Pending'}</span></td>
              <td>${new Date(order.timestamp).toLocaleDateString()}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('recentOrders').innerHTML = recentOrdersHtml || '<tr><td colspan="6" style="text-align: center">No orders found</td></tr>';
      });
    }

    // Update trend element with appropriate icon and color
    function updateTrendElement(elementId, trendValue) {
      const element = document.getElementById(elementId);
      const valueElement = element.querySelector('span:last-child');
      const iconElement = element.querySelector('i');
      
      valueElement.textContent = `${Math.abs(trendValue).toFixed(1)}%`;
      
      if (trendValue >= 0) {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-up trend-up';
      } else {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-down trend-down';
      }
    }

    // Get status badge class
    function getStatusBadgeClass(status) {
      switch(status) {
        case 'Delivered': return 'badge-success';
        case 'Shipped': return 'badge-info';
        case 'Confirmed': return 'badge-info';
        case 'Cancelled': return 'badge-error';
        default: return 'badge-warning';
      }
    }

    // Load products
    function loadProducts() {
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val() || {};
        const products = Object.values(productsData);
        const filteredProducts = filterProductsList(products);
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        
        // Update pagination
        updatePagination('productsPagination', currentProductsPage, totalPages, 'products');
        
        // Get products for current page
        const startIndex = (currentProductsPage - 1) * productsPerPage;
        const paginatedProducts = filteredProducts.slice(startIndex, startIndex + productsPerPage);
        
        // Render products table
        const productsHtml = paginatedProducts.map(product => {
          return `
            <tr>
              <td><img src="${product.images[0]}" width="50" height="50" style="object-fit: cover; border-radius: 6px"></td>
              <td>${product.title}</td>
              <td>${product.category}</td>
              <td>₹${product.price}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn secondary btn-sm" onclick="editProduct('${product.id}')"><i class="fas fa-edit"></i></button>
                  <button class="btn error btn-sm" onclick="deleteProductConfirm('${product.id}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('productsTable').innerHTML = productsHtml || '<tr><td colspan="6" style="text-align: center">No products found</td></tr>';
      });
    }

    // Filter products list
    function filterProductsList(products) {
      const searchTerm = document.getElementById('productSearch').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      
      return products.filter(product => {
        const matchesSearch = product.title.toLowerCase().includes(searchTerm) || 
                             product.desc.toLowerCase().includes(searchTerm);
        const matchesCategory = !category || product.category === category;
        
        return matchesSearch && matchesCategory;
      });
    }

    // Filter products
    function filterProducts() {
      currentProductsPage = 1;
      loadProducts();
    }

    // Load orders
    function loadOrders() {
      Promise.all([
        new Promise(resolve => {
          productsRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        }),
        new Promise(resolve => {
          ordersRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        })
      ]).then(([productsData, ordersData]) => {
        const products = Object.values(productsData);
        const orders = Object.values(ordersData);
        const filteredOrders = filterOrdersList(orders, products);
        const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
        
        // Update pagination
        updatePagination('ordersPagination', currentOrdersPage, totalPages, 'orders');
        
        // Get orders for current page
        const startIndex = (currentOrdersPage - 1) * ordersPerPage;
        const paginatedOrders = filteredOrders.slice(startIndex, startIndex + ordersPerPage);
        
        // Render orders table
        const ordersHtml = paginatedOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td><input type="checkbox" value="${order.id}"></td>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname}<br><small>${order.mobile}</small></td>
              <td>${product ? product.title : 'Unknown Product'} (x${order.qty})</td>
              <td>₹${product ? product.price * order.qty : 'N/A'}</td>
              <td>
                <select onchange="updateOrderStatus('${order.id}', this.value)" class="status-select">
                  <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                  <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                  <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                  <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                  <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
              </td>
              <td>${new Date(order.timestamp).toLocaleDateString()}</td>
              <td>
                <button class="btn secondary btn-sm" onclick="viewOrderDetails('${order.id}')"><i class="fas fa-eye"></i></button>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('ordersTable').innerHTML = ordersHtml || '<tr><td colspan="8" style="text-align: center">No orders found</td></tr>';
      });
    }

    // Filter orders list
    function filterOrdersList(orders, products) {
      const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
      const status = document.getElementById('statusFilter').value;
      const date = document.getElementById('dateFilter').value;
      
      return orders.filter(order => {
        const product = products.find(p => p.id === order.productId);
        const productName = product ? product.title.toLowerCase() : '';
        const matchesSearch = order.fullname.toLowerCase().includes(searchTerm) || 
                             order.mobile.includes(searchTerm) ||
                             productName.includes(searchTerm);
        const matchesStatus = !status || order.status === status;
        const matchesDate = !date || new Date(order.timestamp).toLocaleDateString() === new Date(date).toLocaleDateString();
        
        return matchesSearch && matchesStatus && matchesDate;
      });
    }

    // Filter orders
    function filterOrders() {
      currentOrdersPage = 1;
      loadOrders();
    }

    // Update order status
    function updateOrderStatus(orderId, status) {
      ordersRef.child(orderId).update({ status: status })
        .then(() => {
          loadOrders();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
        })
        .catch(error => {
          console.error('Error updating order status:', error);
          alert('Error updating order status. Please try again.');
        });
    }

    // Apply bulk action to orders
    function applyBulkAction() {
      const status = document.getElementById('bulkStatusAction').value;
      if (!status) {
        alert('Please select a status action');
        return;
      }
      
      const checkboxes = document.querySelectorAll('#ordersTable input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        alert('Please select at least one order');
        return;
      }
      
      // Check if trying to update more than 100 orders
      if (checkboxes.length > 100) {
        alert('You can only update up to 100 orders at a time');
        return;
      }
      
      if (!confirm(`Are you sure you want to update ${checkboxes.length} order(s) to ${status}?`)) {
        return;
      }
      
      const orderIds = Array.from(checkboxes).map(cb => cb.value);
      
      // Update each order status in Firebase
      const updates = {};
      orderIds.forEach(orderId => {
        updates[`${orderId}/status`] = status;
      });
      
      ordersRef.update(updates)
        .then(() => {
          loadOrders();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          // Uncheck select all
          document.getElementById('selectAllOrders').checked = false;
        })
        .catch(error => {
          console.error('Error updating orders:', error);
          alert('Error updating orders. Please try again.');
        });
    }

    // View order details
    function viewOrderDetails(orderId) {
      Promise.all([
        new Promise(resolve => {
          productsRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        }),
        new Promise(resolve => {
          ordersRef.child(orderId).once('value', snapshot => {
            resolve(snapshot.val());
          });
        })
      ]).then(([productsData, order]) => {
        if (!order) {
          alert('Order not found');
          return;
        }
        
        const products = Object.values(productsData);
        const product = products.find(p => p.id === order.productId);
        
        const detailsHtml = `
          <h3>Order Details #${order.id}</h3>
          <p><strong>Customer:</strong> ${order.fullname}</p>
          <p><strong>Mobile:</strong> ${order.mobile}</p>
          <p><strong>Address:</strong> ${order.house}, ${order.city}, ${order.state} - ${order.pincode}</p>
          <p><strong>Product:</strong> ${product ? product.title : 'Unknown'} (x${order.qty})</p>
          <p><strong>Amount:</strong> ₹${product ? product.price * order.qty : 'N/A'}</p>
          <p><strong>Status:</strong> ${order.status || 'Pending'}</p>
          <p><strong>Order Date:</strong> ${new Date(order.timestamp).toLocaleString()}</p>
          <p><strong>Payment Method:</strong> ${order.payment === 'prepaid' ? 'Prepaid' : 'Cash on Delivery'}</p>
        `;
        
        alert(detailsHtml);
      });
    }

    // Load trending products
    function loadTrendingProducts() {
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val() || {};
        const products = Object.values(productsData);
        
        const trendingHtml = products.map(product => {
          return `
            <tr>
              <td><img src="${product.images[0]}" width="50" height="50" style="object-fit: cover; border-radius: 6px"></td>
              <td>${product.title}</td>
              <td>₹${product.price}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn ${product.trending ? 'error' : 'success'} btn-sm" onclick="toggleTrending('${product.id}', ${!product.trending})">
                    <i class="fas ${product.trending ? 'fa-times' : 'fa-fire'}"></i> 
                    ${product.trending ? 'Remove' : 'Add'}
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('trendingTable').innerHTML = trendingHtml || '<tr><td colspan="5" style="text-align: center">No products found</td></tr>';
      });
    }

    // Toggle trending status
    function toggleTrending(productId, isTrending) {
      productsRef.child(productId).update({ trending: isTrending })
        .then(() => {
          loadTrendingProducts();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
        })
        .catch(error => {
          console.error('Error updating trending status:', error);
          alert('Error updating product. Please try again.');
        });
    }

    // Load customers
    function loadCustomers() {
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val() || {};
        const orders = Object.values(ordersData);
        
        // Extract unique customers based on mobile number
        const customersMap = {};
        orders.forEach(order => {
          if (!customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname,
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city}, ${order.state}`,
              orderCount: 1,
              lastOrder: order.timestamp
            };
          } else {
            customersMap[order.mobile].orderCount++;
            if (new Date(order.timestamp) > new Date(customersMap[order.mobile].lastOrder)) {
              customersMap[order.mobile].lastOrder = order.timestamp;
            }
          }
        });
        
        const customers = Object.values(customersMap);
        const filteredCustomers = filterCustomersList(customers);
        const totalPages = Math.ceil(filteredCustomers.length / customersPerPage);
        
        // Update pagination
        updatePagination('customersPagination', currentCustomersPage, totalPages, 'customers');
        
        // Get customers for current page
        const startIndex = (currentCustomersPage - 1) * customersPerPage;
        const paginatedCustomers = filteredCustomers.slice(startIndex, startIndex + customersPerPage);
        
        // Render customers table
        const customersHtml = paginatedCustomers.map(customer => {
          return `
            <tr>
              <td>${customer.name}</td>
              <td>${customer.mobile}</td>
              <td>${customer.email}</td>
              <td>${customer.location}</td>
              <td>${customer.orderCount}</td>
              <td>${new Date(customer.lastOrder).toLocaleDateString()}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('customersTable').innerHTML = customersHtml || '<tr><td colspan="6" style="text-align: center">No customers found</td></tr>';
      });
    }

    // Filter customers list
    function filterCustomersList(customers) {
      const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
      
      return customers.filter(customer => {
        return customer.name.toLowerCase().includes(searchTerm) || 
               customer.mobile.includes(searchTerm) ||
               customer.email.toLowerCase().includes(searchTerm) ||
               customer.location.toLowerCase().includes(searchTerm);
      });
    }

    // Filter customers
    function filterCustomers() {
      currentCustomersPage = 1;
      loadCustomers();
    }

    // Load policies
    function loadPolicies() {
      policiesRef.once('value', snapshot => {
        const policies = snapshot.val() || {};
        
        // Set policy content
        document.getElementById('aboutContent').value = policies.about || '';
        document.getElementById('refundContent').value = policies.refund || '';
        document.getElementById('termsContent').value = policies.terms || '';
        document.getElementById('shippingContent').value = policies.shipping || '';
        document.getElementById('privacyContent').value = policies.privacy || '';
      });
    }

    // Save policy
    function savePolicy(policyType) {
      const content = document.getElementById(`${policyType}Content`).value;
      
      policiesRef.update({ [policyType]: content })
        .then(() => {
          alert(`${policyType.charAt(0).toUpperCase() + policyType.slice(1)} policy saved successfully!`);
        })
        .catch(error => {
          console.error('Error saving policy:', error);
          alert('Error saving policy. Please try again.');
        });
    }

    // Show add product modal
    function showAddProductModal() {
      // Reset form
      document.getElementById('productName').value = '';
      document.getElementById('productPrice').value = '';
      document.getElementById('productCategory').value = '';
      document.getElementById('productDesc').value = '';
      document.getElementById('productFullDesc').value = '';
      document.getElementById('productSizes').value = '';
      document.getElementById('productTrending').checked = false;
      document.getElementById('imagePreview').innerHTML = '';
      uploadedImages = [];
      
      // Show modal
      document.getElementById('addProductModal').classList.add('active');
    }

    // Handle image upload
    function handleImageUpload(input) {
      if (input.files && input.files.length > 0) {
        const preview = document.getElementById('imagePreview');
        
        Array.from(input.files).forEach(file => {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            // Store image data
            uploadedImages.push(e.target.result);
            
            // Create preview
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.innerHTML = `
              <img src="${e.target.result}" alt="Preview">
              <div class="remove-image" onclick="removeImage(this)">&times;</div>
            `;
            
            preview.appendChild(previewItem);
          };
          
          reader.readAsDataURL(file);
        });
      }
    }

    // Remove image from upload preview
    function removeImage(button) {
      const previewItem = button.parentElement;
      const imgSrc = previewItem.querySelector('img').src;
      const index = uploadedImages.indexOf(imgSrc);
      
      if (index !== -1) {
        uploadedImages.splice(index, 1);
      }
      
      previewItem.remove();
    }

    // Save product
    function saveProduct() {
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const category = document.getElementById('productCategory').value;
      const desc = document.getElementById('productDesc').value;
      const fullDesc = document.getElementById('productFullDesc').value;
      const sizes = document.getElementById('productSizes').value.split(',').map(s => s.trim());
      const trending = document.getElementById('productTrending').checked;
      
      // Validation
      if (!name || !price || !category || !desc) {
        alert('Please fill in all required fields');
        return;
      }
      
      if (uploadedImages.length === 0) {
        alert('Please upload at least one product image');
        return;
      }
      
      // Generate a unique ID for the new product
      const newProductId = productsRef.push().key;
      
      // Create new product
      const newProduct = {
        id: newProductId,
        title: name,
        price: parseInt(price),
        desc: desc,
        fullDesc: fullDesc,
        images: uploadedImages,
        sizes: sizes,
        category: category,
        trending: trending
      };
      
      // Add to products in Firebase
      productsRef.child(newProductId).set(newProduct)
        .then(() => {
          // Close modal and refresh products list
          closeModal('addProductModal');
          loadProducts();
          loadTrendingProducts();
          
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          alert('Product added successfully!');
        })
        .catch(error => {
          console.error('Error adding product:', error);
          alert('Error adding product. Please try again.');
        });
    }

    // Edit product
    function editProduct(productId) {
      productsRef.child(productId).once('value', snapshot => {
        const product = snapshot.val();
        
        if (!product) {
          alert('Product not found');
          return;
        }
        
        // Fill form with product data
        document.getElementById('editProductId').value = product.id;
        document.getElementById('editProductName').value = product.title;
        document.getElementById('editProductPrice').value = product.price;
        document.getElementById('editProductCategory').value = product.category;
        document.getElementById('editProductDesc').value = product.desc;
        document.getElementById('editProductFullDesc').value = product.fullDesc;
        document.getElementById('editProductSizes').value = product.sizes.join(', ');
        document.getElementById('editProductTrending').checked = product.trending;
        
        // Show modal
        document.getElementById('editProductModal').classList.add('active');
      });
    }

    // Update product
    function updateProduct() {
      const productId = document.getElementById('editProductId').value;
      const name = document.getElementById('editProductName').value;
      const price = document.getElementById('editProductPrice').value;
      const category = document.getElementById('editProductCategory').value;
      const desc = document.getElementById('editProductDesc').value;
      const fullDesc = document.getElementById('editProductFullDesc').value;
      const sizes = document.getElementById('editProductSizes').value.split(',').map(s => s.trim());
      const trending = document.getElementById('editProductTrending').checked;
      
      // Validation
      if (!name || !price || !category || !desc) {
        alert('Please fill in all required fields');
        return;
      }
      
      // Update product in Firebase
      productsRef.child(productId).update({
        title: name,
        price: parseInt(price),
        desc: desc,
        fullDesc: fullDesc,
        sizes: sizes,
        category: category,
        trending: trending
      })
      .then(() => {
        // Close modal and refresh products list
        closeModal('editProductModal');
        loadProducts();
        loadTrendingProducts();
        
        // If on dashboard, refresh it too
        if (currentAdminTab === 'dashboard') {
          loadDashboardData();
        }
        
        alert('Product updated successfully!');
      })
      .catch(error => {
        console.error('Error updating product:', error);
        alert('Error updating product. Please try again.');
      });
    }

    // Delete product confirmation
    function deleteProductConfirm(productId) {
      if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        deleteProduct(productId);
      }
    }

    // Delete product
    function deleteProduct(productId) {
      productsRef.child(productId).remove()
        .then(() => {
          // Close modal and refresh products list
          closeModal('editProductModal');
          loadProducts();
          loadTrendingProducts();
          
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          alert('Product deleted successfully!');
        })
        .catch(error => {
          console.error('Error deleting product:', error);
          alert('Error deleting product. Please try again.');
        });
    }

    // Export orders
    function exportOrders() {
      Promise.all([
        new Promise(resolve => {
          productsRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        }),
        new Promise(resolve => {
          ordersRef.once('value', snapshot => {
            resolve(snapshot.val() || {});
          });
        })
      ]).then(([productsData, ordersData]) => {
        const products = Object.values(productsData);
        const orders = Object.values(ordersData);
        
        if (orders.length === 0) {
          alert('No orders to export');
          return;
        }
        
        // Create CSV content
        let csv = 'Order ID,Customer,Product,Quantity,Amount,Status,Date\n';
        
        orders.forEach(order => {
          const product = products.find(p => p.id === order.productId);
          csv += `"${order.id || 'N/A'}","${order.fullname}","${product ? product.title : 'Unknown'}","${order.qty}","${product ? product.price * order.qty : 'N/A'}","${order.status || 'Pending'}","${new Date(order.timestamp).toLocaleDateString()}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_orders_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }

    // Export customers
    function exportCustomers() {
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val() || {};
        const orders = Object.values(ordersData);
        
        if (orders.length === 0) {
          alert('No customer data to export');
          return;
        }
        
        // Extract unique customers based on mobile number
        const customersMap = {};
        orders.forEach(order => {
          if (!customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname,
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city}, ${order.state}`,
              orderCount: 1
            };
          } else {
            customersMap[order.mobile].orderCount++;
          }
        });
        
        const customers = Object.values(customersMap);
        
        // Create CSV content
        let csv = 'Name,Mobile,Email,Location,Orders\n';
        
        customers.forEach(customer => {
          csv += `"${customer.name}","${customer.mobile}","${customer.email}","${customer.location}","${customer.orderCount}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_customers_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }

    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    // Update pagination
    function updatePagination(elementId, currentPage, totalPages, type) {
      const pagination = document.getElementById(elementId);
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      // Previous button
      if (currentPage > 1) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage - 1})">&laquo;</div>`;
      }
      
      // Page numbers
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, startPage + 4);
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<div class="page-item ${i === currentPage ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</div>`;
      }
      
      // Next button
      if (currentPage < totalPages) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage + 1})">&raquo;</div>`;
      }
      
      pagination.innerHTML = html;
    }

    // Change page
    function changePage(type, page) {
      if (type === 'products') {
        currentProductsPage = page;
        loadProducts();
      } else if (type === 'orders') {
        currentOrdersPage = page;
        loadOrders();
      } else if (type === 'customers') {
        currentCustomersPage = page;
        loadCustomers();
      }
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', initAdminPanel);
  </script>
</body>
</html>