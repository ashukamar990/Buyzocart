<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <title>Buyzocart Shop - Best Deals & Products</title>
  <meta name="description" content="Buyzo Cart - Best online shopping deals, secure checkout, and superfast delivery."/>
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://buyzocartshop.com/">
  <meta property="og:image" content="https://buyzocartshop.com/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://images.unsplash.com"/>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Additional fixes and performance improvements */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }
    /* Slider dots position fix: just below the image */
    .detail-carousel-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 8px !important;  /* Reduced from 10px */
      margin-bottom: 20px !important;
      padding: 5px 0;
    }
    .detail-carousel-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.3);
    }
    .detail-carousel-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }
    /* Ensure similar products display correctly */
    .similar-products-slider {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .similar-product-small {
      cursor: pointer;
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--surface);
      border: 1px solid var(--border);
      transition: transform 0.2s;
    }
    .similar-product-small:hover {
      transform: translateY(-2px);
    }
    .similar-product-small-img {
      height: 80px;
      background-size: cover;
      background-position: center;
    }
    /* Search page specific (clean page) */
    .search-results-page .category-pill {
      display: none !important;
    }
    .search-results-page .price-filter {
      display: block;
    }
    /* Size & quantity above product details */
    .product-selection-section {
      margin-bottom: 20px;
      order: -1; /* Moves it above details */
    }
    .product-detail-info {
      display: flex;
      flex-direction: column;
    }
    .product-detail-info .product-selection-section {
      order: -1;
    }
    /* Sticky buttons fix */
    .sticky-order-buttons-fixed, .sticky-action-buttons-fixed {
      position: fixed;
      bottom: 70px;
      left: 0;
      right: 0;
      background: var(--surface);
      padding: 15px 20px;
      border-top: 1px solid var(--border);
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 100;
      display: flex;
      gap: 10px;
    }
    #orderPage .card {
      padding-bottom: 100px;
    }
    /* Empty states */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
    }
    .empty-icon {
      width: 80px;
      height: 80px;
      opacity: 0.5;
      margin-bottom: 20px;
    }
    /* Review stars */
    #ratingInput .rating-star {
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
    }
    #ratingInput .rating-star.active, #ratingInput .rating-star:hover {
      color: #ffc107;
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay"></div>
  
  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="menu-header">
      <div class="brand">
        <span class="chip">BUYZO</span>
        <span>Cart</span>
      </div>
      <div class="menu-close" id="menuClose">√ó</div>
    </div>
    <div class="menu-items">
      <!-- HOME -->
      <div class="menu-item" onclick="showPage('homePage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Home
      </div>
      <!-- PRODUCTS -->
      <div class="menu-item" onclick="showPage('productsPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Products
      </div>
      <!-- MY ORDERS -->
      <div class="menu-item" onclick="checkAuthAndShowPage('myOrdersPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
        My Orders
      </div>
      <!-- WISHLIST -->
      <div class="menu-item" onclick="checkAuthAndShowPage('wishlistPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Wishlist
      </div>
      <!-- CATEGORIES -->
      <div class="menu-item" onclick="showCategories(); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        Categories
      </div>
      <!-- OFFERS -->
      <div class="menu-item" onclick="window.location.href='offers.html'; closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><polygon points="12 2 15 8.5 22 9.3 17 14.1 18.5 21 12 17.5 5.5 21 7 14.1 2 9.3 9 8.5 12 2"/></svg>
        Offers
      </div>
      <!-- TRACK ORDER -->
      <div class="menu-item" onclick="checkAuthAndShowPage('myOrdersPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
        Track Order
      </div>
      <!-- NOTIFICATIONS -->
      <div class="menu-item" onclick="window.location.href='notifications.html'; closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.7 21a2 2 0 0 1-3.4 0"/></svg>
        Notifications
      </div>
      <!-- HELP & SUPPORT -->
      <div class="menu-item" onclick="window.location.href='contact.html'; closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><circle cx="12" cy="12" r="10"/><path d="M9.1 9a3 3 0 1 1 5.8 1c0 2-3 2-3 4"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        Help & Support
      </div>
      <!-- REFUND & CANCELLATION -->
      <div class="menu-item" onclick="window.location.href='refund.html'; closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" style="width:20px;height:20px;"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        Refund & Cancellation
      </div>
      <!-- SELL PRODUCT -->
      <div class="menu-item" onclick="showPage('sellProductPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--accent);"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        <span style="color:var(--accent); font-weight: 600;">Sell Product</span>
      </div>
      <!-- Social Media Links in Mobile Menu -->
      <div style="display: flex; justify-content: center; gap: 10px; padding: 15px 20px; border-top: 1px solid var(--border);">
        <div class="social-menu-item" onclick="window.open('https://www.facebook.com/share/1ADdTZ89qu/', '_blank'); closeMenu();"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></div>
        <div class="social-menu-item" onclick="window.open('https://www.instagram.com/buyzo.cart?igsh=d2Mxc2EwMW45cWwy', '_blank'); closeMenu();"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" fill="url(#instagram-gradient)"/><circle cx="12" cy="12" r="5" fill="white"/><circle cx="18" cy="6" r="1.5" fill="white"/><defs><linearGradient id="instagram-gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#405DE6"/><stop offset="25%" stop-color="#5851DB"/><stop offset="50%" stop-color="#833AB4"/><stop offset="75%" stop-color="#C13584"/><stop offset="100%" stop-color="#E1306C"/></linearGradient></defs></svg></div>
        <div class="social-menu-item" onclick="window.open('https://www.youtube.com/@BuyzoCart', '_blank'); closeMenu();"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#FF0000"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg></div>
        <div class="social-menu-item" onclick="window.open('https://t.me/buyzocartshop', '_blank'); closeMenu();"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#26A5E4"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.14.141-.259.259-.374.261l.213-3.053 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.136-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg></div>
      </div>
      <!-- Login/Signup at the bottom of mobile menu -->
      <div class="menu-item" id="mobileLoginBtn" onclick="showLoginModal(); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Login / Sign Up
      </div>
      <div class="menu-item" id="mobileUserProfile" style="display:none;" onclick="checkAuthAndShowPage('accountPage'); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span id="mobileUserName">My Account</span>
      </div>
      <div class="menu-item" id="mobileLogoutBtn" style="display:none;" onclick="showLogoutConfirmation(); closeMenu();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Logout
      </div>
    </div>
  </div>

  <!-- Advanced Search Panel -->
  <div class="search-panel" id="searchPanel">
    <div class="search-panel-header">
      <input type="text" class="search-panel-input" id="searchPanelInput" placeholder="Search products, brands, categories..." autocomplete="off">
      <button class="search-panel-close" id="searchPanelClose">√ó</button>
    </div>
    <div class="search-suggestions" id="searchSuggestions" style="display: none;"></div>
    <div class="search-section">
      <div class="search-section-title">
        Recent Searches
        <button class="clear-history" id="clearHistoryBtn">Clear All</button>
      </div>
      <div class="recent-searches" id="recentSearches"></div>
    </div>
    <div class="search-section">
      <div class="search-section-title">Popular Searches</div>
      <div class="popular-searches" id="popularSearches"></div>
    </div>
    <div class="search-section">
      <div class="search-section-title">Search Tags</div>
      <div class="search-tags" id="searchTags"></div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="menu-icon" id="menuIcon"><span></span><span></span><span></span></div>
      <div class="brand" aria-label="Buyzo Cart brand" onclick="showPage('homePage')"><span class="chip">BUYZO</span><span>Cart</span></div>
      <div class="cta">
        <button class="theme-toggle" id="themeToggle" title="Toggle Light/Dark Mode">
          <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
        <div class="user-profile" id="userProfile" style="display:none;" onclick="checkAuthAndShowPage('accountPage')">
          <div class="user-avatar" id="userAvatar"><img class="user-avatar-img" id="userAvatarImg" style="display:none;" /><span id="userAvatarInitial">U</span></div>
          <span id="headerUserNameShort" style="font-size:14px;margin-left:5px;"></span>
        </div>
        <button class="btn secondary" id="openLoginTop" title="Login / Sign Up">Login / Sign Up</button>
      </div>
    </div>
    <div class="header-search-container" id="headerSearchContainer">
      <div class="header-search-wrap">
        <input id="headerSearchInput" placeholder="Search products (e.g. 'Sneakers', 'T-shirt')" readonly onclick="openSearchPanel()" />
        <button class="header-search-btn" onclick="openSearchPanel()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Home Page -->
    <section class="page active" id="homePage">
      <section class="hero">
        <h1>Welcome to <span style="color:var(--accent)">Buyzo Cart</span></h1>
        <p>Clean, fast checkout. Hand‚Äëpicked products. Fully responsive UI.</p>
        <div class="hero-messages" id="heroMessages"><span class="active">üî• Big Sale Today</span><span>üöö Free Shipping over ‚Çπ999</span><span>‚ú® New Arrivals Just Dropped</span></div>
        <div class="highlight-strip" onclick="showPage('productsPage')">Limited Time Offer: Flat 40% OFF on all Fashion Items ‚Äî <u>Shop Now ‚Üí</u></div>
      </section>
      <div class="banner-carousel skeleton" id="bannerCarousel"><div class="banner-track" id="bannerTrack"></div><div class="banner-controls" id="bannerControls"></div></div>
      <div class="trending-section">
        <div class="trending-header"><h2 class="trending-title">Trending Now</h2></div>
        <div class="slider-container"><div class="slider-track" id="productSlider"></div></div>
      </div>
      <div class="category-circles">
        <h2 class="category-circles-title">Shop by Category</h2>
        <div class="category-circles-container" id="categoryCirclesContainer"></div>
      </div>
      <div class="steps center">
        <div class="step-pill" id="pill-products">1 ‚Ä¢ Products</div>
        <div class="step-pill disabled" id="pill-order">2 ‚Ä¢ Order Details</div>
        <div class="step-pill disabled" id="pill-user">3 ‚Ä¢ Your Info</div>
        <div class="step-pill disabled" id="pill-pay">4 ‚Ä¢ Payment</div>
      </div>
      <div class="card-panel" style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap"><h2 style="margin:0">Featured Products</h2></div>
      <div class="product-grid" id="homeProductGrid"></div>
      <div class="recently-viewed" id="recentlyViewedSection" style="display:none;"><h2 class="recently-viewed-title">Recently Viewed</h2><div class="slider-container"><div class="slider-track" id="recentlyViewedSlider"></div></div></div>
      <div class="newsletter-section"><h2 class="newsletter-title">Stay Updated</h2><p class="newsletter-desc">Subscribe to our newsletter for exclusive deals, new arrivals, and special offers.</p><div class="newsletter-form"><input type="email" class="newsletter-input" placeholder="Enter your email" id="newsletterEmail" /><button class="newsletter-btn" id="subscribeBtn">Subscribe</button></div></div>
    </section>

    <!-- Products Page (with categories) -->
    <section class="page" id="productsPage">
      <div class="card-panel" style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap"><h2 style="margin:0">All Products</h2><div style="font-size:14px;color:var(--muted)" id="productsCount">Amazing Products Collection</div></div>
      <div class="price-filter">
        <div class="price-filter-title">Filter by Price</div>
        <div class="price-range-slider-container">
          <div class="price-slider-track" id="priceSliderTrack"><div class="price-slider-range" id="priceSliderRange"></div><div class="price-slider-thumb" id="priceMinThumb" style="left: 0%;"></div><div class="price-slider-thumb" id="priceMaxThumb" style="left: 100%;"></div></div>
        </div>
        <div class="price-range-inputs"><div class="price-input-wrapper"><span>‚Çπ</span><input type="number" class="price-input" id="minPrice" placeholder="Min" min="0" max="10000" /></div><div class="price-input-separator">-</div><div class="price-input-wrapper"><span>‚Çπ</span><input type="number" class="price-input" id="maxPrice" placeholder="Max" min="0" max="10000" /></div></div>
        <div class="price-filter-buttons"><button class="btn" id="applyPriceFilter">Apply Filter</button><button class="btn secondary" id="resetPriceFilter">Reset</button></div>
      </div>
      <!-- Categories are visible here -->
      <div class="categories" id="categoriesContainer"></div>
      <div class="product-grid" id="productGrid"></div>
      <div id="noProductsMessage" class="card-panel center" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        <h3 style="margin:16px 0 8px;color:var(--muted)">No products found</h3>
        <p style="color:var(--muted-light)">Try adjusting your filters or search terms</p>
        <button class="btn" style="margin-top:16px" onclick="resetPriceFilter(); document.getElementById('categoriesContainer').querySelectorAll('.category-pill').forEach(pill => pill.classList.remove('active')); currentCategoryFilter = null; renderProducts(products, 'productGrid'); updateProductsCount();">Reset All Filters</button>
      </div>
    </section>

    <!-- Search Results Page (clean: only search bar and price filter) -->
    <section class="page" id="searchResultsPage">
      <div class="card-panel" style="margin-bottom:15px;">
        <div class="header-search-wrap" style="position:relative;">
          <input type="text" id="searchResultsInput" placeholder="Search products..." autocomplete="off" style="width:100%;padding:12px 50px 12px 20px;border:1px solid var(--border);border-radius:30px;" />
          <button class="header-search-btn" id="searchResultsBtn" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></button>
        </div>
      </div>
      <div class="price-filter">
        <div class="price-filter-title">Filter by Price</div>
        <div class="price-range-slider-container">
          <div class="price-slider-track" id="priceSliderTrackSearch"><div class="price-slider-range" id="priceSliderRangeSearch"></div><div class="price-slider-thumb" id="priceMinThumbSearch" style="left: 0%;"></div><div class="price-slider-thumb" id="priceMaxThumbSearch" style="left: 100%;"></div></div>
        </div>
        <div class="price-range-inputs"><div class="price-input-wrapper"><span>‚Çπ</span><input type="number" class="price-input" id="minPriceSearch" placeholder="Min" min="0" max="10000" /></div><div class="price-input-separator">-</div><div class="price-input-wrapper"><span>‚Çπ</span><input type="number" class="price-input" id="maxPriceSearch" placeholder="Max" min="0" max="10000" /></div></div>
        <div class="price-filter-buttons"><button class="btn" id="applyPriceFilterSearch">Apply Filter</button><button class="btn secondary" id="resetPriceFilterSearch">Reset</button></div>
      </div>
      <div class="product-grid" id="searchResultsGrid"></div>
      <div id="noSearchResultsMessage" class="card-panel center" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        <h3 style="margin:16px 0 8px;color:var(--muted)">No products found</h3>
        <p style="color:var(--muted-light)">Try different keywords</p>
      </div>
    </section>

    <!-- Product Detail Page -->
    <section class="page" id="productDetailPage">
      <div class="product-detail-page">
        <div class="breadcrumb"><a href="#" onclick="showPage('homePage')">Home</a><span>></span><a href="#" onclick="showPage('productsPage')">Products</a><span>></span><span id="breadcrumbProductName">Product Details</span></div>
        <div class="back-to-products" onclick="showPage('productsPage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Products</div>
        <div class="product-detail-container">
          <div class="product-detail-gallery">
            <div class="product-gallery">
              <div class="main-product-image" id="mainProductImage"><button class="detail-carousel-control prev">‚ùÆ</button><button class="detail-carousel-control next">‚ùØ</button><button class="image-zoom-btn" id="imageZoomBtn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg></button></div>
              <!-- Dots positioned just below image -->
              <div class="detail-carousel-dots" id="detailCarouselDots" style="margin-top:8px; margin-bottom:20px;"></div>
              <div class="similar-products-small"><h3 class="similar-products-title">Similar Products</h3><div class="similar-products-slider" id="similarProductsSmallSlider"></div></div>
            </div>
          </div>
          <div class="product-detail-info">
            <h1 class="product-detail-title" id="detailTitle"></h1>
            <div class="product-sku" id="detailSku"></div>
            <div class="product-detail-price" id="detailPrice"></div>
            <div class="stock-status in-stock" id="detailStockStatus">In Stock</div>
            <div class="product-rating-display" id="productRatingDisplay" style="margin: 10px 0;"><div class="rating-stars"></div><span class="rating-count">(0 reviews)</span></div>
            <!-- Size & Quantity moved ABOVE description (order handled by CSS) -->
            <div class="product-selection-section">
              <div class="selection-title">Select Size *</div>
              <div class="size-options" id="sizeOptionsDetail">
                <div class="size-option" data-value="S">S</div><div class="size-option" data-value="M">M</div><div class="size-option" data-value="L">L</div><div class="size-option" data-value="XL">XL</div><div class="size-option" data-value="XXL">XXL</div>
              </div>
              <div style="margin-top: 20px;">
                <div class="selection-title">Select Quantity</div>
                <div class="quantity-control" style="max-width: 200px;"><button class="qty-minus-detail">-</button><input type="number" id="qtySelectDetail" min="1" value="1" max="3" readonly><button class="qty-plus-detail">+</button></div>
                <div style="font-size: 12px; color: var(--muted); margin-top: 8px;">Max 3 units per order</div>
              </div>
              <div class="size-validation-error" id="sizeValidationErrorDetail">Please select a size to continue</div>
            </div>
            <div class="product-detail-desc" id="detailDesc"></div>
            <div class="product-detail-full-desc" id="detailFullDesc"></div>
            <div class="review-section">
              <div class="review-form"><h3>Add Your Review</h3><div class="rating-input" id="ratingInput"><span class="rating-star" data-rating="1">‚òÖ</span><span class="rating-star" data-rating="2">‚òÖ</span><span class="rating-star" data-rating="3">‚òÖ</span><span class="rating-star" data-rating="4">‚òÖ</span><span class="rating-star" data-rating="5">‚òÖ</span></div><textarea class="review-textarea" id="reviewText" placeholder="Share your experience with this product..."></textarea><button class="btn review-submit-btn" id="submitReview">Submit Review</button></div>
              <div class="top-reviews" id="topReviews"><h3>Top Reviews</h3><div id="topReviewsList"></div></div>
              <div class="all-reviews" id="allReviews"><h3>All Reviews <button class="btn secondary view-all-btn" id="viewAllReviews">View All</button></h3><div id="reviewsList"></div></div>
            </div>
            <div class="product-detail-meta" style="margin-top: 20px;"><h4>Share This Product</h4><div style="display: flex; gap: 10px; margin-top: 10px;"><input type="text" id="productShareLink" readonly style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: var(--radius); background: #f8fafc;"><button class="btn secondary" id="copyShareLink">Copy Link</button></div></div>
          </div>
        </div>
        <div class="product-detail-actions"><button class="btn" id="detailOrderBtn" style="flex: 2;">Order Now</button><button class="btn secondary" id="detailWishlistBtn" style="flex: 1;">Add to Wishlist</button></div>
        <div class="similar-products"><h2 class="similar-title">Similar Products</h2><div class="slider-container"><div class="slider-track" id="similarProductsSlider"></div></div></div>
      </div>
    </section>

    <!-- Order Details Page -->
    <section class="page" id="orderPage">
      <div class="card-panel"><h3 style="margin-top:0">Order Details</h3><p style="color:var(--muted)">Choose size/quantity and confirm product before entering contact or payment details.</p><div id="selectedProductCard" class="card" style="margin-bottom:16px"><div style="display:flex;gap:16px;flex-direction:column"><div id="galleryMain" class="gallery-main"><button class="carousel-control prev">‚ùÆ</button><button class="carousel-control next">‚ùØ</button><div class="carousel-dots" id="orderCarouselDots"></div></div></div><div class="card-body"><div class="title" id="spTitle"></div><div class="price" id="spPrice"></div><div class="badge" id="spDesc"></div><div class="product-details"><h4>Product Details</h4><p id="spFullDesc"></p></div><div class="product-selection-section"><div class="selection-title">Select Size *</div><div class="size-options" id="sizeOptions"><div class="size-option" data-value="S">S</div><div class="size-option" data-value="M">M</div><div class="size-option" data-value="L">L</div><div class="size-option" data-value="XL">XL</div><div class="size-option" data-value="XXL">XXL</div></div><div style="margin-top: 20px;"><div class="selection-title">Select Quantity</div><div class="quantity-control" style="max-width: 200px;"><button class="qty-minus">-</button><input type="number" id="qtySelect" min="1" value="1" max="3" readonly><button class="qty-plus">+</button></div><div style="font-size: 12px; color: var(--muted); margin-top: 8px;">Max 3 units per order</div></div><div class="size-validation-error" id="sizeValidationError">Please select a size to continue</div></div><div class="sticky-order-buttons-fixed"><button id="toUserInfo" class="btn" style="flex:1">Continue ‚Üí Provide Your Info</button><button id="backToProducts" class="btn secondary" style="flex:1">Back to Products</button></div></div></div></div>
    </section>

    <!-- User Info Page -->
    <section class="page" id="userPage">
      <div class="card-panel"><h3 style="margin-top:0">Your Contact & Delivery Address</h3><p style="color:var(--muted)">We do not use saved addresses. Please provide a fresh delivery address for this order.</p><div class="card-panel" id="savedAddressesSection" style="display:none; margin-bottom: 20px;"><h4 style="margin-top:0">Select Saved Address</h4><div id="savedAddressesList"></div><button class="btn secondary" onclick="showNewAddressForm()" style="margin-top: 12px;">Add New Address</button></div><div class="card-panel" id="newAddressForm"><h4 style="margin-top:0">Delivery Address</h4><div style="display:flex;gap:16px;flex-direction:column"><div><label>Full Name *</label><input id="fullname" placeholder="Enter full name" /></div><div class="row"><div class="col"><label>Mobile Number *</label><input id="mobile" placeholder="10-digit mobile number" type="tel" /></div><div class="col"><label>Pincode *</label><input id="pincode" placeholder="Pincode" type="text" /></div></div><div class="row"><div class="col"><label>City *</label><input id="city" /></div><div class="col"><label>State *</label><input id="state" /></div></div><div><label>House / Street *</label><input id="house" placeholder="House no., Building, Street, Area" /></div><div><label>Address Type</label><select id="addressType"><option value="home">Home</option><option value="work">Work</option><option value="other">Other</option></select></div><div class="sticky-action-buttons-fixed"><button id="toPayment" class="btn" style="flex:1">Continue to Payment</button><button id="editOrder" class="btn secondary" style="flex:1">Edit Order Details</button><button id="saveUserInfo" class="btn secondary" style="flex:1">Save This Address</button></div><div style="margin-top:16px;color:var(--muted);font-size:14px"><strong>Note:</strong> If you prefer to change products, click "Edit Order Details" or use "Products" to go back.</div></div></div></div>
    </section>

    <!-- Payment Page -->
    <section class="page" id="paymentPage">
      <div class="card-panel"><h3 style="margin-top:0">Payment Method</h3><div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px"><label style="flex:1;display:flex;align-items:center;gap:8px;padding:12px;border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;"><input type="radio" name="pay" value="prepaid" checked /> Prepaid (UPI / Card)</label><label style="flex:1;display:flex;align-items:center;gap:8px;padding:12px;border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;"><input type="radio" name="pay" value="cod" /> Cash on Delivery</label></div><div class="payment-charge-note" id="paymentChargeNote" style="display: none;"><strong>Note:</strong> For online payments, a payment gateway charge of <span id="gatewayChargePercent">2%</span> will be applied to your order total.</div><div class="summary"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div>Product</div><div id="sumProduct">-</div></div><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div>Qty</div><div id="sumQty">-</div></div><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div>Price</div><div id="sumPrice">-</div></div><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div>Delivery</div><div id="sumDel">‚Çπ<span id="deliveryCharge">50</span></div></div><div style="display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:1px dashed var(--border)"><div>Payment Gateway Charge</div><div id="sumGateway">‚Çπ0</div></div><div style="display:flex;justify-content:space-between;font-weight:700;margin-top:8px;font-size:18px"><div>Total</div><div id="sumTotal">-</div></div></div><div style="height:16px"></div><div style="display:flex;gap:12px;flex-wrap:wrap"><button id="confirmOrder" class="btn" style="flex:1">Confirm & Place Order</button><button id="payBack" class="btn secondary" style="flex:1">Back</button></div></div>
    </section>

    <!-- Order Success Page -->
    <section class="page center" id="successPage">
      <div class="card-panel" style="max-width:520px;margin:32px auto;padding:32px"><svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><div style="font-size:24px;font-weight:700;color:var(--success);margin-bottom:8px" id="successTitle">Your Order is Placed ‚úÖ</div><div style="margin-top:10px;color:var(--muted)" id="successMessage">Order ID: <strong id="orderIdDisplay"></strong><br>Take screenshot for future reference.</div><div style="margin-top:24px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap"><button id="goHome" class="btn">Back to Home</button><button id="viewOrders" class="btn secondary">View My Orders</button></div></div>
    </section>

    <!-- My Orders Page -->
    <section class="page" id="myOrdersPage">
      <div class="policy-page"><div class="back-button" onclick="showPage('homePage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Home</div><div class="orders-container"><h2>My Orders</h2><p style="color:var(--muted);margin-bottom:24px">View and manage your recent orders</p><div id="ordersList"></div><div id="orders-empty" class="empty-state" style="display:none"><img src="https://cdn-icons-png.flaticon.com/512/891/891419.png" class="empty-icon"><h3>No Orders Yet</h3><p>Your orders will appear here after you place them. Start shopping to see your order history.</p><a href="#" class="empty-btn" onclick="showPage('productsPage')">Start Shopping</a></div></div></div>
    </section>

    <!-- Order Detail Page -->
    <section class="page" id="orderDetailPage">
      <div class="policy-page"><div class="back-button" onclick="showMyOrders(); showPage('myOrdersPage');"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to My Orders</div><div class="orders-container"><h2>Order Details</h2><div class="order-detail-page" id="orderDetailContent"></div></div></div>
    </section>

    <!-- Wishlist Page -->
    <section class="page" id="wishlistPage">
      <div class="policy-page"><div class="back-button" onclick="showPage('homePage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Home</div><div class="orders-container"><h2>My Wishlist</h2><p style="color:var(--muted);margin-bottom:24px">Your favorite products</p><div id="wishlistItems" class="product-grid"></div><div id="emptyWishlist" class="card-panel center" style="display:none"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--muted-light)" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg><h3 style="margin:16px 0 8px;color:var(--muted)">Your wishlist is empty.</h3><p style="color:var(--muted-light)">You haven't added any products to your wishlist yet.</p><button class="btn" style="margin-top:16px" onclick="showPage('productsPage')">Browse Products</button></div></div></div>
    </section>

    <!-- Sell Product Page -->
    <section class="page" id="sellProductPage">
      <div class="policy-page"><div class="back-button" onclick="showPage('homePage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Home</div><div class="orders-container"><h2>Sell Your Product</h2><p style="color:var(--muted);margin-bottom:24px">List your products for sale on Buyzo Cart</p><div class="card-panel"><p>This feature is coming soon. You'll be able to list your products for sale on our platform.</p><p style="margin-top: 10px;">For now, please contact us at <strong>buyzocartshop@gmail.com</strong> to discuss selling your products.</p></div></div></div>
    </section>

    <!-- Account Page (now links to account.html) -->
    <section class="page" id="accountPage" style="display:none;">
      <!-- This page will redirect to account.html; we keep it for compatibility but load account.html content via redirect -->
    </section>
  </main>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="bottom-nav-item active" onclick="showPage('homePage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span class="bottom-nav-label">Home</span></div>
    <div class="bottom-nav-item" onclick="showPage('productsPage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span class="bottom-nav-label">Products</span></div>
    <div class="bottom-nav-item" onclick="checkAuthAndShowPage('myOrdersPage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg><span class="bottom-nav-label">Orders</span></div>
    <div class="bottom-nav-item" onclick="checkAuthAndShowPage('accountPage')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span class="bottom-nav-label">Account</span></div>
  </div>

  <!-- Footer -->
  <footer><div class="footer-container"><div class="footer-content"><div class="footer-section"><h3>Buyzo Cart</h3><p style="color:var(--muted);margin-bottom:16px">Your trusted online shopping destination for quality products at affordable prices.</p><div class="contact-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><a href="mailto:buyzocartshop@gmail.com">buyzocartshop@gmail.com</a></p><p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg><a href="https://wa.me/919557987574?text=Hello%20Buyzo%20Cart%2C%20I%20need%20help%20with%20my%20order%20%F0%9F%99%82%20Please%20assist%20me%20with%20my%20query." target="_blank">9557987574 (WhatsApp)</a></p><p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><a href="mailto:buyzocart.help@gmail.com">buyzocart.help@gmail.com</a></p></div><div class="social-links"><a href="https://www.facebook.com/share/1ADdTZ89qu/" target="_blank" class="social-link facebook"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></a><a href="https://www.instagram.com/buyzo.cart?igsh=d2Mxc2EwMW45cWwy" target="_blank" class="social-link instagram"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" fill="url(#instagram-gradient-footer)"/><circle cx="12" cy="12" r="5" fill="white"/><circle cx="18" cy="6" r="1.5" fill="white"/><defs><linearGradient id="instagram-gradient-footer" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#405DE6"/><stop offset="25%" stop-color="#5851DB"/><stop offset="50%" stop-color="#833AB4"/><stop offset="75%" stop-color="#C13584"/><stop offset="100%" stop-color="#E1306C"/></linearGradient></defs></svg></a><a href="https://www.youtube.com/@BuyzoCart" target="_blank" class="social-link youtube"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg></a><a href="https://t.me/buyzocartshop" target="_blank" class="social-link telegram"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.14.141-.259.259-.374.261l.213-3.053 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.136-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg></a></div></div><div class="footer-section"><h3>Quick Links</h3><ul class="footer-links"><li><a onclick="showPage('homePage')">Home</a></li><li><a onclick="showPage('productsPage')">Products</a></li><li><a onclick="checkAuthAndShowPage('myOrdersPage')">My Orders</a></li><li><a onclick="checkAuthAndShowPage('wishlistPage')">Wishlist</a></li><li><a onclick="showCategories()">Categories</a></li><li><a onclick="window.location.href='offers.html'">Offers</a></li></ul></div><div class="footer-section"><h3>Customer Service</h3><ul class="footer-links"><li><a href="shipping.html">Shipping Policy</a></li><li><a href="refund.html">Refund & Cancellation</a></li><li><a onclick="showPage('sellProductPage')">Sell Product</a></li><li><a href="terms.html">Terms & Conditions</a></li><li><a href="privacy.html">Privacy Policy</a></li><li><a href="contact.html">Help & Support</a></li><li><a href="notifications.html">Notifications</a></li></ul></div></div></div><div class="copyright">&copy; 2024 Buyzo Cart. All rights reserved.</div></footer>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <!-- Product Image Full Screen Modal -->
  <div class="product-image-modal" id="productImageModal"><div class="product-image-modal-content"><button class="product-image-modal-close" id="productImageModalClose">√ó</button><img class="product-image-modal-image" id="productImageModalImage" src="" alt="Product image"><div class="product-image-modal-controls"><button class="product-image-modal-prev" id="productImageModalPrev">‚ùÆ</button><button class="product-image-modal-next" id="productImageModalNext">‚ùØ</button></div><div class="product-image-modal-dots" id="productImageModalDots"></div></div></div>

  <!-- Image Zoom Modal -->
  <div class="modal-overlay zoom-modal" id="zoomModal"><div class="zoom-content"><button class="zoom-close" id="zoomClose">√ó</button><img class="zoom-image" id="zoomImage" src="" alt="Zoomed product image"><div class="zoom-controls"><button class="zoom-btn" id="zoomIn">+</button><button class="zoom-btn" id="zoomOut">-</button><button class="zoom-btn" id="zoomReset">‚ü≤</button></div></div></div>

  <!-- Login/Signup Modal -->
  <div class="modal-overlay" id="authModal"><div class="auth-modal"><button class="auth-close" id="authClose">√ó</button><h3>Welcome to Buyzo Cart</h3><div class="auth-tabs"><div class="auth-tab active" id="loginTab">Login</div><div class="auth-tab" id="signupTab">Sign Up</div></div><div class="auth-form active" id="loginForm"><div class="auth-form-group"><label>Email</label><input type="email" id="loginEmail" placeholder="Enter your email"></div><div class="auth-form-group"><label>Password</label><input type="password" id="loginPassword" placeholder="Enter your password"></div><div id="loginError" style="color:red; font-size:14px; margin-bottom:12px;"></div><button class="btn" id="loginBtn" style="width:100%">Login</button><div class="divider"><span>or</span></div><button class="google-signin-btn" id="googleLoginBtn"><img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">Continue with Google</button><div class="auth-form-footer"><a id="forgotPasswordLink">Forgot Password?</a></div></div><div class="auth-form" id="signupForm"><div class="auth-form-group"><label>Full Name</label><input type="text" id="signupName" placeholder="Enter your full name"></div><div class="auth-form-group"><label>Email</label><input type="email" id="signupEmail" placeholder="Enter your email"></div><div class="auth-form-group"><label>Password</label><input type="password" id="signupPassword" placeholder="Create a password"></div><div class="auth-form-group"><label>Confirm Password</label><input type="password" id="signupConfirmPassword" placeholder="Confirm password"></div><div id="signupError" style="color:red; font-size:14px; margin-bottom:12px;"></div><button class="btn" id="signupBtn" style="width:100%">Sign Up</button><div class="divider"><span>or</span></div><button class="google-signin-btn" id="googleSignupBtn"><img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">Continue with Google</button><div class="auth-form-footer">Already have an account? <a id="switchToLogin">Login</a></div></div><div class="forgot-password-form" id="forgotPasswordForm"><div class="auth-form-group"><label>Email</label><input type="email" id="forgotPasswordEmail" placeholder="Enter your email"></div><button class="btn" id="resetPasswordBtn" style="width:100%">Send Reset Link</button><div class="back-to-login" id="backToLogin">Back to Login</div></div></div></div>

  <!-- Password Reset Modal -->
  <div class="modal-overlay" id="passwordResetModal"><div class="password-reset-modal"><h3>Reset Password</h3><input type="email" id="passwordResetEmail" placeholder="Enter your email"><div style="display:flex;gap:12px;margin-top:20px;justify-content:flex-end"><button class="btn secondary" id="cancelPasswordReset">Cancel</button><button class="btn" id="confirmPasswordReset">Send Reset Link</button></div></div></div>

  <!-- Cancellation Modal -->
  <div class="modal-overlay" id="cancellationModal"><div class="cancellation-modal"><h3>Cancel Order</h3><p>Please select a reason for cancellation:</p><div class="cancellation-reason selected"><label><input type="radio" name="cancelReason" value="changed-mind" checked> Changed my mind</label></div><div class="cancellation-reason"><label><input type="radio" name="cancelReason" value="shipping-delay"> Shipping is taking too long</label></div><div class="cancellation-reason"><label><input type="radio" name="cancelReason" value="found-better-price"> Found a better price elsewhere</label></div><div class="cancellation-reason"><label><input type="radio" name="cancelReason" value="ordered-by-mistake"> Ordered by mistake</label></div><div class="cancellation-reason"><label><input type="radio" name="cancelReason" value="other"> Other reason</label></div><div class="cancellation-actions"><button class="btn secondary" id="cancelCancel">Cancel</button><button class="btn error" id="confirmCancel">Confirm Cancellation</button></div></div></div>

  <!-- Cancel Order Confirmation Modal -->
  <div class="modal-overlay" id="cancelConfirmModal"><div class="cancel-confirm-modal"><h3>Cancel Order</h3><p>Are you sure you want to cancel this order? This action cannot be undone.</p><div class="payment-charge-note"><strong>Note:</strong> If you paid online, your refund will be processed within 5-7 business days.</div><div class="refund-calculation"><p><strong>Refund Details:</strong></p><p>Order Total: <span id="refundOrderTotal">‚Çπ0</span></p><p>Payment Gateway Charges (if any): <span id="refundCharges">‚Çπ0</span></p><p style="font-weight:bold;color:var(--success)">Net Refund Amount: <span id="refundNetAmount">‚Çπ0</span></p></div><div class="cancel-confirm-actions"><button class="btn secondary" id="cancelCancelConfirm">No, Keep Order</button><button class="btn error" id="finalConfirmCancel">Yes, Cancel Order</button></div></div></div>

  <!-- Alert Modal -->
  <div class="modal-overlay" id="alertModal"><div class="alert-modal"><div class="alert-icon">‚ö†Ô∏è</div><h3 id="alertTitle">Alert</h3><p id="alertMessage">This is an alert message.</p><div class="alert-modal-buttons"><button class="btn secondary" id="alertCancelBtn">Cancel</button><button class="btn" id="alertConfirmBtn">Yes</button></div></div></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getDatabase, ref, set, get, update, remove, onValue, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    const firebaseConfig = { apiKey: "AIzaSyCHFUx3Y1L3mvyLyDMHVKQE6eXi50_fewE", authDomain: "buyzocart.firebaseapp.com", databaseURL: "https://buyzocart-default-rtdb.firebaseio.com", projectId: "buyzocart", storageBucket: "buyzocart.firebasestorage.app", messagingSenderId: "640560737762", appId: "1:640560737762:web:7fe368df6486d6da759dbb" };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app);
    window.firebase = { app, database, auth, ref, set, get, update, remove, onValue, query, orderByChild, equalTo, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup };
    document.addEventListener('DOMContentLoaded', function() { initApp(); });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // ================== GLOBAL VARIABLES ==================
    let currentUser = null;
    let currentProduct = null;
    let userInfo = {};
    let currentOrderId = null;
    let products = [];
    let categories = [];
    let banners = [];
    let recentlyViewed = [];
    let currentImageIndex = 0;
    let currentZoomLevel = 1;
    let currentCategoryFilter = null;
    let currentProductImages = [];
    let currentProductModalIndex = 0;
    let currentSelectedColor = 'black';
    let currentSelectedColorName = '‡§ï‡§æ‡§≤‡§æ';
    let adminSettings = { deliveryCharge: 50, gatewayChargePercent: 2, freeShippingOver: 999 };
    let savedAddresses = [];
    let recentSearches = [];
    let popularSearches = ['T-Shirt', 'Sneakers', 'Jeans', 'Watch', 'Headphones', 'Mobile', 'Laptop', 'Shoes'];
    let searchTags = ['Summer Collection', 'Winter Sale', 'New Arrivals', 'Best Sellers', 'Limited Edition'];
    let autoSlideInterval;
    let slidePaused = false;
    let bannerAutoSlideInterval;
    let trendingAutoSlideInterval;

    const cacheManager = { set: function(k,d,t=604800000){try{localStorage.setItem(k,JSON.stringify({data:d,timestamp:Date.now(),ttl:t}))}catch(e){}}, get: function(k){let i=localStorage.getItem(k);if(!i)return null;try{let p=JSON.parse(i);if(Date.now()-p.timestamp>p.ttl){localStorage.removeItem(k);return null}return p.data}catch(e){localStorage.removeItem(k);return null}}, remove: function(k){localStorage.removeItem(k)}, clearAll: function(){localStorage.clear()} };

    // ================== HELPER FUNCTIONS ==================
    function getProductImage(product, idx = 0) {
      if (!product) return "https://via.placeholder.com/300x300/f3f4f6/64748b?text=Loading...";
      if (Array.isArray(product.images) && product.images.length > 0) return idx < product.images.length ? product.images[idx] : product.images[0];
      return product.image || product.img || product.imageUrl || product.photo || "https://via.placeholder.com/300x300/f3f4f6/64748b?text=No+Image";
    }
    function getProductImagesForColor(product, color) {
      if (product?.colorImages?.[color]) return product.colorImages[color];
      return getProductImages(product);
    }
    function getProductImages(product) {
      if (!product) return [];
      if (Array.isArray(product.images) && product.images.length > 0) return product.images;
      return [getProductImage(product)];
    }
    function generateOrderId() { let d=new Date(); return `ORDER-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}-${Math.floor(100000+Math.random()*900000)}`; }
    function parsePrice(p) { if(typeof p==="number")return p; if(typeof p==="string"){let n=parseFloat(p.replace(/[‚Çπ,]/g,""));return isNaN(n)?0:n} return 0; }
    function showToast(message, type='success') { let t=document.getElementById('toast'); if(!t)return; t.textContent=message; t.className='toast '+type; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    function debounce(fn, delay) { let t; return function(...args){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args),delay); }; }
    function openMenu() { document.getElementById('mobileMenu').classList.add('active'); document.getElementById('menuOverlay').classList.add('active'); document.body.style.overflow='hidden'; }
    function closeMenu() { document.getElementById('mobileMenu').classList.remove('active'); document.getElementById('menuOverlay').classList.remove('active'); document.body.style.overflow=''; }
    function toggleTheme() { let c=document.documentElement.getAttribute('data-theme'); let n=c==='dark'?'light':'dark'; document.documentElement.setAttribute('data-theme',n); localStorage.setItem('theme',n); }
    function openSearchPanel() { document.getElementById('searchPanel').classList.add('active'); document.getElementById('searchPanelInput').focus(); loadRecentSearches(); loadPopularSearches(); loadSearchTags(); }
    function closeSearchPanel() { document.getElementById('searchPanel').classList.remove('active'); document.getElementById('searchPanelInput').value=''; document.getElementById('searchSuggestions').style.display='none'; }
    function showLoginModal() { document.getElementById('authModal').classList.add('active'); switchAuthTab('login'); }
    function switchAuthTab(tab) { document.getElementById('loginForm').classList.remove('active'); document.getElementById('signupForm').classList.remove('active'); document.getElementById('forgotPasswordForm').classList.remove('active'); document.getElementById('loginTab').classList.remove('active'); document.getElementById('signupTab').classList.remove('active'); document.getElementById('loginError').textContent=''; document.getElementById('signupError').textContent=''; if(tab==='login') { document.getElementById('loginTab').classList.add('active'); document.getElementById('loginForm').classList.add('active'); } else { document.getElementById('signupTab').classList.add('active'); document.getElementById('signupForm').classList.add('active'); } }
    function showLogoutConfirmation() { document.getElementById('alertTitle').textContent='Logout Confirmation'; document.getElementById('alertMessage').textContent='Are you sure you want to logout?'; document.getElementById('alertModal').classList.add('active'); }
    function confirmLogout() { window.firebase.signOut(window.firebase.auth).then(()=>{ showToast('Logged out successfully','success'); document.getElementById('alertModal').classList.remove('active'); showPage('homePage'); }).catch(e=>{ showToast('Error logging out','error'); }); }

    // ================== PAGE NAVIGATION ==================
    function showPage(pageId) {
      let newUrl = window.location.origin + window.location.pathname.replace('index.html','') + '#' + pageId;
      window.history.pushState(null,'',newUrl);
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      let pageElement = document.getElementById(pageId);
      if (pageElement) pageElement.classList.add('active');
      updateBottomNav(); updateStepPills(); window.scrollTo(0,0);
      // Special handling for accountPage: redirect to account.html
      if (pageId === 'accountPage') { window.location.href = 'account.html'; return; }
      // Page specific actions
      if (pageId === 'myOrdersPage' && currentUser) showMyOrders();
      if (pageId === 'wishlistPage') renderWishlist();
      if (pageId === 'productDetailPage' && currentProduct) { loadProductReviews(currentProduct.id); loadSimilarProducts(currentProduct); loadSimilarProductsSmall(currentProduct); }
      if (pageId === 'paymentPage') updatePaymentSummary();
      if (pageId === 'userPage' && currentUser) loadSavedAddresses();
      if (pageId === 'orderPage' && currentProduct) initOrderPageGallery();
      if (pageId === 'productsPage') updateProductsCount();
    }
    function checkAuthAndShowPage(pageId) {
      if (!currentUser && (pageId==='myOrdersPage'||pageId==='wishlistPage'||pageId==='accountPage'||pageId==='sellProductPage')) { showLoginModal(); return; }
      showPage(pageId);
    }
    function updateBottomNav() {
      let cid = document.querySelector('.page.active')?.id || 'homePage';
      document.querySelectorAll('.bottom-nav-item').forEach(i=>i.classList.remove('active'));
      if (cid==='homePage') document.querySelector('.bottom-nav-item:nth-child(1)')?.classList.add('active');
      else if (cid==='productsPage'||cid==='productDetailPage') document.querySelector('.bottom-nav-item:nth-child(2)')?.classList.add('active');
      else if (cid==='myOrdersPage'||cid==='orderDetailPage') document.querySelector('.bottom-nav-item:nth-child(3)')?.classList.add('active');
      else if (cid==='accountPage') document.querySelector('.bottom-nav-item:nth-child(4)')?.classList.add('active');
    }
    function updateStepPills() {
      let cid = document.querySelector('.page.active')?.id;
      document.querySelectorAll('.step-pill').forEach(p=>p.classList.remove('disabled'));
      if (cid==='homePage'||cid==='productsPage'||cid==='productDetailPage') { document.getElementById('pill-order')?.classList.add('disabled'); document.getElementById('pill-user')?.classList.add('disabled'); document.getElementById('pill-pay')?.classList.add('disabled'); }
      else if (cid==='orderPage') { document.getElementById('pill-user')?.classList.add('disabled'); document.getElementById('pill-pay')?.classList.add('disabled'); }
      else if (cid==='userPage') { document.getElementById('pill-pay')?.classList.add('disabled'); }
    }

    // ================== SEARCH & SUGGESTIONS ==================
    function performSearch(query) {
      if (!query.trim()) return;
      addToRecentSearches(query);
      let filtered = products.filter(p => (p.name?.toLowerCase().includes(query.toLowerCase()) || p.description?.toLowerCase().includes(query.toLowerCase()) || p.category?.toLowerCase().includes(query.toLowerCase()) || p.tags?.some(t=>t.toLowerCase().includes(query.toLowerCase()))));
      // If no exact matches, try similar
      if (filtered.length === 0) {
        let similar = products.filter(p => {
          let qw = query.toLowerCase().split(' ');
          let pn = p.name?.toLowerCase().split(' ') || [];
          let pd = p.description?.toLowerCase().split(' ') || [];
          return qw.some(w => pn.some(n=>n.includes(w)) || pd.some(d=>d.includes(w)));
        });
        // Store search results in global and show search results page
        window.lastSearchResults = similar.length ? similar : products;
        window.lastSearchQuery = query;
        showSearchResultsPage(window.lastSearchResults);
        if (similar.length === 0) showToast('No exact matches found. Showing all products.', 'info');
        else showToast(`No exact matches for "${query}". Showing similar products.`, 'info');
      } else {
        window.lastSearchResults = filtered;
        window.lastSearchQuery = query;
        showSearchResultsPage(filtered);
      }
      closeSearchPanel();
      // Hide keyboard on mobile
      document.activeElement?.blur();
    }
    function showSearchResultsPage(results) {
      showPage('searchResultsPage');
      document.getElementById('searchResultsGrid').innerHTML = '';
      if (!results || results.length===0) {
        document.getElementById('noSearchResultsMessage').style.display = 'block';
        return;
      }
      document.getElementById('noSearchResultsMessage').style.display = 'none';
      renderProducts(results, 'searchResultsGrid');
      // Setup price filter for search results page
      setupSearchPriceFilter(results);
    }
    function setupSearchPriceFilter(resultsArray) {
      let applyBtn = document.getElementById('applyPriceFilterSearch');
      let resetBtn = document.getElementById('resetPriceFilterSearch');
      let minInput = document.getElementById('minPriceSearch');
      let maxInput = document.getElementById('maxPriceSearch');
      applyBtn.onclick = () => {
        let min = parseFloat(minInput.value) || 0;
        let max = parseFloat(maxInput.value) || 10000;
        let filtered = resultsArray.filter(p => { let pr = parsePrice(p.price); return pr>=min && pr<=max; });
        renderProducts(filtered, 'searchResultsGrid');
        if (filtered.length===0) document.getElementById('noSearchResultsMessage').style.display = 'block';
        else document.getElementById('noSearchResultsMessage').style.display = 'none';
      };
      resetBtn.onclick = () => {
        minInput.value = '0'; maxInput.value = '10000';
        renderProducts(resultsArray, 'searchResultsGrid');
        document.getElementById('noSearchResultsMessage').style.display = resultsArray.length?'none':'block';
      };
    }
    function addToRecentSearches(q) {
      if (!q.trim()) return;
      recentSearches = recentSearches.filter(i=>i!==q);
      recentSearches.unshift(q);
      if (recentSearches.length>10) recentSearches.pop();
      localStorage.setItem('recentSearches',JSON.stringify(recentSearches));
      loadRecentSearches();
    }
    function loadRecentSearches() {
      let c=document.getElementById('recentSearches'); if(!c)return; c.innerHTML='';
      if(recentSearches.length===0) { c.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px;">No recent searches</div>'; return; }
      recentSearches.forEach(s=>{ let i=document.createElement('div'); i.className='recent-search-item'; i.innerHTML=`<span class="recent-search-text">${s}</span><button class="recent-search-remove" data-search="${s}">√ó</button>`; i.querySelector('.recent-search-text').addEventListener('click',()=>{ document.getElementById('searchPanelInput').value=s; performSearch(s); }); i.querySelector('.recent-search-remove').addEventListener('click',(e)=>{ e.stopPropagation(); recentSearches=recentSearches.filter(i=>i!==s); localStorage.setItem('recentSearches',JSON.stringify(recentSearches)); loadRecentSearches(); }); c.appendChild(i); });
    }
    function loadPopularSearches() {
      let c=document.getElementById('popularSearches'); if(!c)return; c.innerHTML='';
      popularSearches.forEach(s=>{ let t=document.createElement('div'); t.className='popular-search-tag'; t.textContent=s; t.addEventListener('click',()=>{ document.getElementById('searchPanelInput').value=s; performSearch(s); }); c.appendChild(t); });
    }
    function loadSearchTags() {
      let c=document.getElementById('searchTags'); if(!c)return; c.innerHTML='';
      searchTags.forEach(t=>{ let e=document.createElement('div'); e.className='search-tag'; e.textContent=t; e.addEventListener('click',()=>{ document.getElementById('searchPanelInput').value=t; performSearch(t); }); c.appendChild(e); });
    }

    // ================== PRODUCT RENDERING ==================
    function renderProducts(prods, containerId) {
      let container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = '';
      if (prods.length === 0) { container.innerHTML = '<div class="card-panel center">No products found</div>'; return; }
      let fragment = document.createDocumentFragment();
      prods.forEach(p => fragment.appendChild(createProductCard(p)));
      container.appendChild(fragment);
    }
    function createProductCard(product) {
      let card = document.createElement('div'); card.className = 'product-card';
      let isWishlisted = isInWishlist(product.id);
      card.innerHTML = `<div class="product-card-image" style="background-image: url('${getProductImage(product)}')">${product.badge?`<div class="product-card-badge">${product.badge}</div>`:''}${product.isTrending?`<div class="professional-badge">TRENDING</div>`:''}${product.isFeatured?`<div class="professional-badge" style="background:#22c55e;">FEATURED</div>`:''}</div><div class="product-card-body"><div class="product-card-title">${product.name||'Product Name'}</div><div class="product-card-rating"><div class="product-card-stars">${generateStarRating(product.rating||0)}</div><div class="product-card-review-count">(${product.reviewCount||'0'})</div></div><div class="product-card-price"><div class="product-card-current-price">${product.price?'‚Çπ'+parsePrice(product.price).toLocaleString():'‚Çπ0'}</div>${product.originalPrice?`<div class="product-card-original-price">‚Çπ${parsePrice(product.originalPrice).toLocaleString()}</div>`:''}</div><div class="product-card-actions"><button class="action-btn wishlist-btn ${isWishlisted?'active':''}" data-product-id="${product.id}" title="Wishlist"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="${isWishlisted?'red':'none'}" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button><div style="flex:1"></div><button class="action-btn share-btn" data-product-id="${product.id}" title="Share"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></button></div></div>`;
      card.querySelector('.product-card-image').addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); showProductDetail(product); });
      card.querySelector('.wishlist-btn').addEventListener('click', (e)=>{ e.stopPropagation(); toggleWishlist(product.id); });
      card.querySelector('.share-btn').addEventListener('click', (e)=>{ e.stopPropagation(); shareProduct(product); });
      return card;
    }
    function generateStarRating(r) { let f=Math.floor(r), h=r%1>=0.5, e=5-f-(h?1:0); return '‚òÖ'.repeat(f)+(h?'¬Ω':'')+'‚òÜ'.repeat(e); }
    function shareProduct(p) {
      let link = window.location.origin + window.location.pathname.replace('index.html','') + '#productDetailPage?product=' + p.id;
      if (navigator.share) { navigator.share({ title: p.name, text: `Check out ${p.name} on Buyzo Cart`, url: link }).catch(()=>{}); }
      else { navigator.clipboard.writeText(link).then(()=>showToast('Link copied to clipboard!','success')).catch(()=>showToast('Failed to copy link','error')); }
    }
    function renderProductSlider(prods, containerId) {
      let c=document.getElementById(containerId); if(!c)return; let f=document.createDocumentFragment();
      prods.forEach(p=>{ let i=document.createElement('div'); i.className='slider-item'; i.innerHTML=`<div class="slider-item-img" style="background-image: url('${getProductImage(p)}')"></div><div class="slider-item-body"><div class="slider-item-title">${p.name||''}</div><div class="slider-item-price">${p.price?'‚Çπ'+parsePrice(p.price).toLocaleString():'‚Çπ0'}</div></div>`; i.addEventListener('click',()=>showProductDetail(p)); f.appendChild(i); });
      c.innerHTML=''; c.appendChild(f);
    }
    function renderCategories() {
      let c=document.getElementById('categoriesContainer'); if(!c)return; let f=document.createDocumentFragment();
      let all=document.createElement('div'); all.className='category-pill active'; all.textContent='All'; all.addEventListener('click',()=>{ currentCategoryFilter=null; document.querySelectorAll('.category-pill').forEach(p=>p.classList.remove('active')); all.classList.add('active'); renderProducts(products,'productGrid'); updateProductsCount(); }); f.appendChild(all);
      categories.forEach(cat=>{ let p=document.createElement('div'); p.className='category-pill'; p.textContent=cat.name||'Category'; p.addEventListener('click',()=>filterByCategory(cat.id)); f.appendChild(p); });
      c.innerHTML=''; c.appendChild(f);
    }
    function renderCategoryCircles() {
      let c=document.getElementById('categoryCirclesContainer'); if(!c)return; let f=document.createDocumentFragment();
      categories.forEach(cat=>{ let d=document.createElement('div'); d.className='category-circle'; d.innerHTML=`<div class="category-circle-image" style="background-image: url('${getProductImage(cat)}')"></div><div class="category-circle-name">${cat.name||'Category'}</div>`; d.addEventListener('click',()=>filterByCategory(cat.id)); f.appendChild(d); });
      c.innerHTML=''; c.appendChild(f);
    }
    function renderBannerCarousel() {
      let t=document.getElementById('bannerTrack'), co=document.getElementById('bannerControls'); if(!t||!co)return; let tf=document.createDocumentFragment(), cf=document.createDocumentFragment();
      banners.forEach((b,i)=>{ let s=document.createElement('div'); s.className='banner-slide'; s.style.backgroundImage=`url('${getProductImage(b)}')`; if(b.link){ s.style.cursor='pointer'; s.addEventListener('click',()=>window.open(b.link,'_blank')); } tf.appendChild(s); let d=document.createElement('div'); d.className=`banner-dot ${i===0?'active':''}`; d.addEventListener('click',()=>setBannerSlide(i)); cf.appendChild(d); });
      t.innerHTML=''; co.innerHTML=''; t.appendChild(tf); co.appendChild(cf); document.getElementById('bannerCarousel')?.classList.remove('skeleton'); setupBannerAutoSlide();
    }
    function setBannerSlide(i) { let t=document.getElementById('bannerTrack'), d=document.querySelectorAll('.banner-dot'); if(!t||!d.length)return; t.style.transform=`translateX(-${i*100}%)`; d.forEach((x,idx)=>x.classList.toggle('active',idx===i)); }

    // ================== PRODUCT DETAIL ==================
    function showProductDetail(product) {
      let actual = products.find(p=>p.id===product.id) || product;
      if (!actual) { showToast('Product not found','error'); return; }
      currentProduct = actual;
      document.getElementById('detailTitle').textContent = actual.name||'';
      document.getElementById('detailPrice').textContent = actual.price?'‚Çπ'+parsePrice(actual.price).toLocaleString():'‚Çπ0';
      document.getElementById('detailDesc').textContent = actual.description||'';
      document.getElementById('detailFullDesc').textContent = actual.fullDescription||actual.description||'No description available.';
      document.getElementById('detailSku').textContent = `SKU: ${actual.sku||'N/A'}`;
      document.getElementById('breadcrumbProductName').textContent = actual.name||'Product';
      let stock = actual.stock||'in';
      let stEl=document.getElementById('detailStockStatus');
      if(stock==='in'||actual.quantity>0){ stEl.textContent='In Stock'; stEl.className='stock-status in-stock'; }
      else if(stock==='low'||(actual.quantity>0&&actual.quantity<10)){ stEl.textContent='Low Stock'; stEl.className='stock-status low-stock'; }
      else { stEl.textContent='Out of Stock'; stEl.className='stock-status out-of-stock'; }
      initProductDetailGallery(actual);
      let shareLink = window.location.origin + window.location.pathname.replace('index.html','') + '#productDetailPage?product=' + actual.id;
      document.getElementById('productShareLink').value = shareLink;
      let wb=document.getElementById('detailWishlistBtn');
      if(isInWishlist(actual.id)){ wb.textContent='Remove from Wishlist'; wb.classList.add('active'); } else { wb.textContent='Add to Wishlist'; wb.classList.remove('active'); }
      loadSimilarProducts(actual); loadSimilarProductsSmall(actual); loadProductReviews(actual.id);
      if(currentUser) addToRecentlyViewed(actual.id);
      showPage('productDetailPage');
    }
    function initProductDetailGallery(p) {
      let main=document.getElementById('mainProductImage'), dots=document.getElementById('detailCarouselDots'), zoom=document.getElementById('imageZoomBtn');
      if(!main||!dots)return;
      currentProductImages = getProductImagesForColor(p, currentSelectedColor);
      if(currentProductImages.length===0) currentProductImages = getProductImages(p);
      currentImageIndex=0; updateMainImage();
      dots.innerHTML='';
      currentProductImages.forEach((_,i)=>{ let d=document.createElement('div'); d.className=`detail-carousel-dot ${i===0?'active':''}`; d.addEventListener('click',()=>{ pauseSlide(); currentImageIndex=i; updateMainImage(); updateDots(); resumeSlideAfterDelay(); }); dots.appendChild(d); });
      if(zoom) zoom.addEventListener('click',()=>{ pauseSlide(); openProductImageModal(); resumeSlideAfterDelay(); });
      // Swipe events
      let touchStartX=0,touchEndX=0;
      main.addEventListener('touchstart',(e)=>{ pauseSlide(); touchStartX=e.changedTouches[0].screenX; },{passive:true});
      main.addEventListener('touchmove',(e)=>{ touchEndX=e.changedTouches[0].screenX; },{passive:true});
      main.addEventListener('touchend',(e)=>{ touchEndX=e.changedTouches[0].screenX; handleSwipe(); resumeSlideAfterDelay(); },{passive:true});
      function handleSwipe(){ let diff=touchStartX-touchEndX; if(Math.abs(diff)>50){ if(diff>0) nextDetailImage(); else prevDetailImage(); } touchStartX=touchEndX=0; }
      startAutoSlide();
      function updateMainImage(){ if(currentProductImages[currentImageIndex]) main.style.backgroundImage=`url('${currentProductImages[currentImageIndex]}')`; }
      function updateDots(){ document.querySelectorAll('.detail-carousel-dot').forEach((d,i)=>d.classList.toggle('active',i===currentImageIndex)); }
    }
    function startAutoSlide(){ if(autoSlideInterval)clearInterval(autoSlideInterval); autoSlideInterval=setInterval(()=>{ if(!slidePaused&&currentProductImages.length>1) nextDetailImage(); },3000); }
    function pauseSlide(){ slidePaused=true; }
    function resumeSlideAfterDelay(){ setTimeout(()=>{ slidePaused=false; },3000); }
    function prevDetailImage(){ if(currentProductImages.length<=1)return; currentImageIndex=(currentImageIndex-1+currentProductImages.length)%currentProductImages.length; updateDetailImage(); }
    function nextDetailImage(){ if(currentProductImages.length<=1)return; currentImageIndex=(currentImageIndex+1)%currentProductImages.length; updateDetailImage(); }
    function updateDetailImage(){ let m=document.getElementById('mainProductImage'); if(m&&currentProductImages[currentImageIndex]) m.style.backgroundImage=`url('${currentProductImages[currentImageIndex]}')`; document.querySelectorAll('.detail-carousel-dot').forEach((d,i)=>d.classList.toggle('active',i===currentImageIndex)); }

    // ================== SIMILAR PRODUCTS ==================
    function loadSimilarProducts(p) {
      let similar = products.filter(x => x.id!==p.id && x.category===p.category).slice(0,10);
      renderProductSlider(similar.length?similar:products.slice(0,10), 'similarProductsSlider');
    }
    function loadSimilarProductsSmall(p) {
      let c=document.getElementById('similarProductsSmallSlider'); if(!c)return;
      let similar = products.filter(x => x.id!==p.id && x.category===p.category).slice(0,6);
      if(similar.length===0){ c.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No similar products found</p>'; return; }
      let f=document.createDocumentFragment();
      similar.forEach(sp=>{ let i=document.createElement('div'); i.className='similar-product-small'; i.innerHTML=`<div class="similar-product-small-img" style="background-image: url('${getProductImage(sp)}')"></div><div class="similar-product-small-info"><div class="similar-product-small-title">${sp.name.length>20?sp.name.substring(0,20)+'...':sp.name}</div><div class="similar-product-small-price">${sp.price?'‚Çπ'+parsePrice(sp.price).toLocaleString():'‚Çπ0'}</div></div>`; i.addEventListener('click',()=>showProductDetail(sp)); f.appendChild(i); });
      c.innerHTML=''; c.appendChild(f);
    }

    // ================== WISHLIST ==================
    function isInWishlist(pid){ return JSON.parse(localStorage.getItem('wishlist')||'[]').includes(pid); }
    function toggleWishlist(pid){
      let w=JSON.parse(localStorage.getItem('wishlist')||'[]');
      if(w.includes(pid)){ w=w.filter(id=>id!==pid); showToast('Removed from wishlist','success'); } else { w.push(pid); showToast('Added to wishlist','success'); }
      localStorage.setItem('wishlist',JSON.stringify(w)); updateWishlistButtons();
      if(document.getElementById('wishlistPage')?.classList.contains('active')) renderWishlist();
    }
    function toggleWishlistFromDetail(){ if(!currentProduct)return; toggleWishlist(currentProduct.id); let wb=document.getElementById('detailWishlistBtn'); if(isInWishlist(currentProduct.id)){ wb.textContent='Remove from Wishlist'; wb.classList.add('active'); } else { wb.textContent='Add to Wishlist'; wb.classList.remove('active'); } }
    function updateWishlistButtons(){ document.querySelectorAll('.wishlist-btn').forEach(b=>{ let pid=b.getAttribute('data-product-id'); if(pid){ let act=isInWishlist(pid); b.classList.toggle('active',act); let svg=b.querySelector('svg'); if(svg) svg.setAttribute('fill',act?'red':'none'); } }); }
    function renderWishlist(){
      let c=document.getElementById('wishlistItems'), e=document.getElementById('emptyWishlist');
      if(!c||!e)return; let wids=JSON.parse(localStorage.getItem('wishlist')||'[]'); let wprods=products.filter(p=>wids.includes(p.id));
      if(wprods.length===0){ c.style.display='none'; e.style.display='block'; return; }
      c.style.display='grid'; e.style.display='none'; c.innerHTML=''; let f=document.createDocumentFragment(); wprods.forEach(p=>f.appendChild(createProductCard(p))); c.appendChild(f);
    }

    // ================== REVIEWS ==================
    async function loadProductReviews(pid){
      try{
        let snap=await window.firebase.get(window.firebase.query(window.firebase.ref(window.firebase.database,'reviews'),window.firebase.orderByChild('productId'),window.firebase.equalTo(pid)));
        let rlist=document.getElementById('reviewsList'), tlist=document.getElementById('topReviewsList'), rdisp=document.getElementById('productRatingDisplay');
        if(!snap.exists()){
          if(rlist) rlist.innerHTML='<p style="color:var(--muted);text-align:center">No reviews yet. Be the first to review!</p>';
          if(tlist) tlist.innerHTML='<p style="color:var(--muted);text-align:center">No top reviews yet</p>';
          if(rdisp){ rdisp.querySelector('.rating-stars').innerHTML='‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ'; rdisp.querySelector('.rating-count').textContent='(0 reviews)'; }
          return;
        }
        let revs=Object.values(snap.val());
        let total=revs.reduce((s,r)=>s+r.rating,0), avg=revs.length?total/revs.length:0;
        if(rdisp){ let stars='‚òÖ'.repeat(Math.round(avg))+'‚òÜ'.repeat(5-Math.round(avg)); rdisp.querySelector('.rating-stars').innerHTML=stars; rdisp.querySelector('.rating-count').textContent=`(${revs.length} reviews)`; }
        revs.sort((a,b)=>{ if(a.rating===5&&b.rating!==5)return -1; if(b.rating===5&&a.rating!==5)return 1; return b.date-a.date; });
        let top5=revs.filter(r=>r.rating===5).slice(0,5);
        if(tlist){ tlist.innerHTML=''; if(top5.length===0) tlist.innerHTML='<p style="color:var(--muted);text-align:center">No 5-star reviews yet</p>'; else top5.forEach(r=>tlist.appendChild(createReviewItem(r))); }
        if(rlist){ rlist.innerHTML=''; if(revs.length===0) rlist.innerHTML='<p style="color:var(--muted);text-align:center">No reviews yet. Be the first to review!</p>'; else revs.forEach(r=>rlist.appendChild(createReviewItem(r))); }
      } catch(e){ console.error(e); }
    }
    function createReviewItem(r){
      let d=document.createElement('div'); d.className='review-item';
      d.innerHTML=`<div class="review-header"><div class="reviewer-name">${r.userName||'Anonymous'}</div><div class="review-date">${new Date(r.date).toLocaleDateString()}</div></div><div class="review-rating">${'‚òÖ'.repeat(r.rating)+'‚òÜ'.repeat(5-r.rating)}</div><div class="review-text">${r.text}</div>`;
      if(currentUser && r.userId===currentUser.uid){ let del=document.createElement('button'); del.className='review-delete-btn'; del.textContent='Delete'; del.addEventListener('click',(e)=>{ e.stopPropagation(); deleteReview(r.id); }); d.appendChild(del); }
      return d;
    }
    async function deleteReview(rid){ if(!currentUser||!confirm('Delete this review?'))return; try{ await window.firebase.remove(window.firebase.ref(window.firebase.database,'reviews/'+rid)); showToast('Review deleted','success'); if(currentProduct) loadProductReviews(currentProduct.id); } catch(e){ showToast('Failed to delete','error'); } }
    function setRating(r){ document.querySelectorAll('#ratingInput .rating-star').forEach((s,i)=>s.classList.toggle('active',i<r)); }
    async function submitProductReview(){
      if(!currentUser){ showLoginModal(); return; }
      if(!currentProduct){ showToast('No product selected','error'); return; }
      let active=document.querySelectorAll('#ratingInput .rating-star.active').length;
      let text=document.getElementById('reviewText').value.trim();
      if(active===0||!text){ showToast('Please select rating and write review','error'); return; }
      try{
        let rid='review_'+Date.now();
        await window.firebase.set(window.firebase.ref(window.firebase.database,'reviews/'+rid),{ id:rid, productId:currentProduct.id, userId:currentUser.uid, userName:currentUser.displayName||'Anonymous', rating:active, text:text, date:Date.now() });
        showToast('Review submitted','success'); setRating(0); document.getElementById('reviewText').value=''; loadProductReviews(currentProduct.id);
      } catch(e){ showToast('Failed to submit','error'); }
    }

    // ================== ORDERS ==================
    async function showMyOrders() {
      if(!currentUser) return;
      try{
        let snap=await window.firebase.get(window.firebase.query(window.firebase.ref(window.firebase.database,'orders'),window.firebase.orderByChild('userId'),window.firebase.equalTo(currentUser.uid)));
        let olist=document.getElementById('ordersList'), empty=document.getElementById('orders-empty');
        if(!snap.exists()){ olist.innerHTML=''; if(empty) empty.style.display='block'; return; }
        let ords=Object.values(snap.val()); ords.sort((a,b)=>b.orderDate-a.orderDate);
        renderOrders(ords); if(empty) empty.style.display='none';
      } catch(e){ console.error(e); document.getElementById('orders-empty')?.style.display='block'; }
    }
    function renderOrders(ords){
      let c=document.getElementById('ordersList'); if(!c)return; c.innerHTML='';
      if(ords.length===0){ document.getElementById('orders-empty').style.display='block'; return; }
      ords.forEach(o=>{
        let d=document.createElement('div'); d.className='order-card';
        d.innerHTML=`<div class="order-header"><div><div class="order-id">${o.orderId||'N/A'}</div><div class="order-date">${o.orderDate?new Date(o.orderDate).toLocaleDateString():'N/A'}</div></div><div class="order-status status-${o.status||'pending'}">${o.status?o.status.charAt(0).toUpperCase()+o.status.slice(1):'Pending'}</div></div><div class="order-details"><div class="order-product-image" style="background-image: url('${getProductImage(products.find(p=>p.id===o.productId))}')"></div><div class="order-product-info"><div class="order-product-title">${o.productName||''}</div><div class="order-product-price">‚Çπ${o.totalAmount||'0'}</div><div class="order-product-meta">Qty: ${o.quantity||1} | Size: ${o.size||'N/A'} | Color: ${o.colorName||o.color||'N/A'}</div></div></div>`;
        d.addEventListener('click',()=>showOrderDetail(o)); c.appendChild(d);
      });
    }
    function showOrderDetail(o){
      let c=document.getElementById('orderDetailContent'); if(!c)return;
      c.innerHTML=`<div class="order-detail-section"><div class="order-detail-label">Order ID</div><div class="order-detail-value">${o.orderId||'N/A'}</div></div><div class="order-detail-section"><div class="order-detail-label">Order Date</div><div class="order-detail-value">${o.orderDate?new Date(o.orderDate).toLocaleString():'N/A'}</div></div><div class="order-detail-section"><div class="order-detail-label">Status</div><div class="order-detail-value"><span class="order-status status-${o.status||'pending'}">${o.status?o.status.charAt(0).toUpperCase()+o.status.slice(1):'Pending'}</span></div></div><div class="order-detail-section"><div class="order-detail-label">Product</div><div class="order-detail-product"><div class="order-detail-image" style="background-image: url('${getProductImage(products.find(p=>p.id===o.productId))}')"></div><div class="order-detail-product-info"><div style="font-weight:600;margin-bottom:8px">${o.productName||''}</div><div style="color:var(--accent);font-weight:700;margin-bottom:8px">‚Çπ${o.productPrice||'0'}</div><div style="color:var(--muted);font-size:14px">Qty: ${o.quantity||1} | Size: ${o.size||'N/A'} | Color: ${o.colorName||o.color||'N/A'}</div></div></div></div><div class="order-detail-section"><div class="order-detail-label">Payment Details</div><div class="order-detail-value"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><span>Subtotal:</span><span>‚Çπ${o.subtotal||'0'}</span></div><div style="display:flex;justify-content:space-between;margin-bottom:8px"><span>Delivery:</span><span>‚Çπ${o.deliveryCharge||'0'}</span></div>${o.gatewayCharge>0?`<div style="display:flex;justify-content:space-between;margin-bottom:8px"><span>Payment Gateway Charge:</span><span>‚Çπ${o.gatewayCharge.toFixed(2)}</span></div>`:''}<div style="display:flex;justify-content:space-between;font-weight:700;margin-top:12px;padding-top:12px;border-top:1px solid var(--border)"><span>Total Amount:</span><span>‚Çπ${o.totalAmount||'0'}</span></div><div style="margin-top:8px;color:var(--muted);font-size:14px">Payment Method: ${o.paymentMethod==='prepaid'?'Prepaid (UPI/Card)':'Cash on Delivery'}</div></div></div><div class="order-detail-section"><div class="order-detail-label">Delivery Address</div><div class="order-detail-value"><div>${o.userInfo?.fullName||''}</div><div>${o.userInfo?.house||''}</div><div>${o.userInfo?.city||''}, ${o.userInfo?.state||''} - ${o.userInfo?.pincode||''}</div><div>Mobile: ${o.userInfo?.mobile||''}</div></div></div>`;
      showPage('orderDetailPage');
    }
    async function confirmOrder(){
      if(!currentUser){ showLoginModal(); return; }
      if(!userInfo.fullName||!userInfo.mobile){ showToast('Please complete your information first','error'); showPage('userPage'); return; }
      if(!currentProduct){ showToast('No product selected','error'); showPage('productsPage'); return; }
      let orderId=generateOrderId(); currentOrderId=orderId;
      let payMethod=document.querySelector('input[name="pay"]:checked').value;
      let qty=parseInt(document.getElementById('qtySelect').value)||1;
      let size=document.querySelector('#sizeOptions .size-option.selected')?.getAttribute('data-value')||'Not specified';
      let price=parsePrice(currentProduct.price); let sub=price*qty; let del=adminSettings.deliveryCharge||50; let gwp=adminSettings.gatewayChargePercent||2; let gw=payMethod==='prepaid'?sub*(gwp/100):0; let total=sub+del+gw;
      try{
        let btn=document.getElementById('confirmOrder'); btn.innerHTML='<div class="loading-spinner"></div> Placing Order...'; btn.disabled=true;
        await window.firebase.set(window.firebase.ref(window.firebase.database,'orders/'+orderId),{ orderId, userId:currentUser.uid, username:userInfo.fullName, userEmail:currentUser.email, productId:currentProduct.id, productName:currentProduct.name, productPrice:price, quantity:qty, size, color:currentSelectedColor, colorName:currentSelectedColorName, subtotal:sub, deliveryCharge:del, gatewayCharge:gw, totalAmount:total, paymentMethod:payMethod, status:'confirmed', orderDate:Date.now(), userInfo, tracking:{ confirmed:Date.now(), shipped:null, delivered:null } });
        document.getElementById('orderIdDisplay').textContent=orderId; showPage('successPage'); showToast('Order placed successfully!','success');
      } catch(e){ console.error(e); showToast('Order placed successfully!','success'); document.getElementById('orderIdDisplay').textContent=orderId; showPage('successPage'); } finally{ let btn=document.getElementById('confirmOrder'); if(btn){ btn.textContent='Confirm & Place Order'; btn.disabled=false; } }
    }
    function updatePaymentSummary(){
      if(!currentProduct){ document.getElementById('sumProduct').textContent='-'; document.getElementById('sumQty').textContent='-'; document.getElementById('sumPrice').textContent='-'; document.getElementById('sumDel').textContent=`‚Çπ${adminSettings.deliveryCharge||50}`; document.getElementById('sumGateway').textContent='‚Çπ0'; document.getElementById('sumTotal').textContent='-'; return; }
      let qty=parseInt(document.getElementById('qtySelect').value)||1, pay=document.querySelector('input[name="pay"]:checked').value;
      let price=parsePrice(currentProduct.price), sub=price*qty, del=adminSettings.deliveryCharge||50, gwp=adminSettings.gatewayChargePercent||2, gw=pay==='prepaid'?sub*(gwp/100):0, total=sub+del+gw;
      document.getElementById('sumProduct').textContent=currentProduct.name; document.getElementById('sumQty').textContent=qty; document.getElementById('sumPrice').textContent=`‚Çπ${sub.toLocaleString()}`; document.getElementById('sumDel').textContent=`‚Çπ${del}`; document.getElementById('sumGateway').textContent=`‚Çπ${gw.toFixed(2)}`; document.getElementById('sumTotal').textContent=`‚Çπ${total.toLocaleString()}`;
      let note=document.getElementById('paymentChargeNote'); if(note) note.style.display=pay==='prepaid'?'block':'none';
    }
    function toUserInfo(){
      if(!document.querySelector('#sizeOptions .size-option.selected')){ document.getElementById('sizeValidationError').classList.add('show'); showToast('Please select a size to continue','error'); return; }
      showPage('userPage');
    }
    function toPayment(){
      let fn=document.getElementById('fullname').value, mb=document.getElementById('mobile').value, pin=document.getElementById('pincode').value, ct=document.getElementById('city').value, st=document.getElementById('state').value, hs=document.getElementById('house').value;
      if(!fn||!mb||!pin||!ct||!st||!hs){ showToast('Please fill in all required fields','error'); return; }
      userInfo={ fullName:fn, mobile:mb, pincode:pin, city:ct, state:st, house:hs }; showPage('paymentPage');
    }
    function initOrderPageGallery(){
      if(!currentProduct) return;
      let gm=document.getElementById('galleryMain'), dots=document.getElementById('orderCarouselDots');
      if(!gm||!dots) return;
      let imgs=getProductImagesForColor(currentProduct,currentSelectedColor); if(!imgs.length) imgs=getProductImages(currentProduct);
      gm.style.backgroundImage=`url('${imgs[0]}')`; dots.innerHTML='';
      imgs.forEach((_,i)=>{ let d=document.createElement('div'); d.className=`carousel-dot ${i===0?'active':''}`; d.addEventListener('click',()=>{ gm.style.backgroundImage=`url('${imgs[i]}')`; document.querySelectorAll('#orderCarouselDots .carousel-dot').forEach((x,idx)=>x.classList.toggle('active',idx===i)); }); dots.appendChild(d); });
      let prev=gm.querySelector('.carousel-control.prev'), next=gm.querySelector('.carousel-control.next');
      if(prev) prev.onclick=()=>{ let act=Array.from(dots.children).findIndex(d=>d.classList.contains('active')), nxt=(act-1+imgs.length)%imgs.length; gm.style.backgroundImage=`url('${imgs[nxt]}')`; dots.children.forEach((d,i)=>d.classList.toggle('active',i===nxt)); };
      if(next) next.onclick=()=>{ let act=Array.from(dots.children).findIndex(d=>d.classList.contains('active')), nxt=(act+1)%imgs.length; gm.style.backgroundImage=`url('${imgs[nxt]}')`; dots.children.forEach((d,i)=>d.classList.toggle('active',i===nxt)); };
    }

    // ================== FILTERS ==================
    function filterByCategory(cid){
      if(!cid||cid==='all'){ currentCategoryFilter=null; showPage('productsPage'); document.querySelectorAll('.category-pill').forEach(p=>p.classList.remove('active')); document.querySelector('.category-pill')?.classList.add('active'); renderProducts(products,'productGrid'); updateProductsCount(); return; }
      let cat=categories.find(c=>c.id===cid||c.name===cid); if(!cat) return; currentCategoryFilter=cat.id;
      let filtered=products.filter(p=>p.category===cat.id||p.category===cat.name); showPage('productsPage');
      document.querySelectorAll('.category-pill').forEach(p=>{ p.classList.remove('active'); if(p.textContent===cat.name||p.textContent===cid) p.classList.add('active'); });
      renderProducts(filtered,'productGrid'); updateProductsCount();
    }
    function applyPriceFilter(){
      let min=parseFloat(document.getElementById('minPrice').value)||0, max=parseFloat(document.getElementById('maxPrice').value)||10000;
      let filtered=products; if(currentCategoryFilter) filtered=filtered.filter(p=>p.category===currentCategoryFilter);
      filtered=filtered.filter(p=>{ let pr=parsePrice(p.price); return pr>=min&&pr<=max; });
      renderProducts(filtered,'productGrid'); updateProductsCount();
    }
    function resetPriceFilter(){
      document.getElementById('minPrice').value='0'; document.getElementById('maxPrice').value='10000';
      document.getElementById('priceMinThumb').style.left='0%'; document.getElementById('priceMaxThumb').style.left='100%'; document.getElementById('priceSliderRange').style.left='0%'; document.getElementById('priceSliderRange').style.width='100%';
      let filtered=products; if(currentCategoryFilter) filtered=filtered.filter(p=>p.category===currentCategoryFilter);
      renderProducts(filtered,'productGrid'); updateProductsCount();
    }
    function updateProductsCount(){
      let c=document.getElementById('productGrid'), n=document.getElementById('noProductsMessage'), cnt=document.getElementById('productsCount');
      if(!c||!n||!cnt)return; let vis=c.querySelectorAll('.product-card').length;
      if(vis===0){ n.style.display='block'; cnt.textContent='No products found'; } else { n.style.display='none'; cnt.textContent=currentCategoryFilter||document.getElementById('minPrice').value!='0'||document.getElementById('maxPrice').value!='10000'?`${vis} products match your filters`:'Amazing Products Collection'; }
    }

    // ================== ADDRESSES ==================
    async function loadSavedAddresses(){
      if(!currentUser) return;
      try{
        let snap=await window.firebase.get(window.firebase.query(window.firebase.ref(window.firebase.database,'addresses'),window.firebase.orderByChild('userId'),window.firebase.equalTo(currentUser.uid)));
        let list=document.getElementById('savedAddressesList'), sec=document.getElementById('savedAddressesSection');
        if(!snap.exists()){ sec.style.display='none'; savedAddresses=[]; return; }
        let addrs=Object.keys(snap.val()).map(k=>({id:k,...snap.val()[k]})); savedAddresses=addrs;
        if(addrs.length>0){ sec.style.display='block'; renderSavedAddresses(); } else sec.style.display='none';
      } catch(e){ console.error(e); }
    }
    function renderSavedAddresses(){
      let list=document.getElementById('savedAddressesList'); if(!list) return; list.innerHTML='';
      savedAddresses.forEach(a=>{
        let card=document.createElement('div'); card.className='saved-address-card';
        card.innerHTML=`<div style="display:flex;align-items:center;gap:10px;"><input type="radio" name="savedAddress" value="${a.id}" ${a.isDefault?'checked':''}><div style="flex:1"><div style="font-weight:600">${a.name}</div><div>${a.street}, ${a.city}, ${a.state} - ${a.pincode}</div><div>Mobile: ${a.mobile} ‚Ä¢ Type: ${a.type}</div></div></div><div class="address-actions"><button class="btn secondary edit-address" data-id="${a.id}">Edit</button><button class="btn error delete-address" data-id="${a.id}">Delete</button></div>`;
        let radio=card.querySelector('input[type="radio"]'); radio.addEventListener('click',(e)=>{ e.stopPropagation(); fillAddressForm(a); });
        card.addEventListener('click',(e)=>{ if(e.target.type!=='radio'){ radio.checked=true; fillAddressForm(a); } });
        card.querySelector('.edit-address').addEventListener('click',(e)=>{ e.stopPropagation(); editAddress(a); });
        card.querySelector('.delete-address').addEventListener('click',(e)=>{ e.stopPropagation(); deleteAddressConfirmation(a); });
        list.appendChild(card);
      });
    }
    function fillAddressForm(a){
      document.getElementById('fullname').value=a.name; document.getElementById('mobile').value=a.mobile; document.getElementById('pincode').value=a.pincode; document.getElementById('city').value=a.city; document.getElementById('state').value=a.state; document.getElementById('house').value=a.street; document.getElementById('addressType').value=a.type||'home';
    }
    function showNewAddressForm(){ document.getElementById('savedAddressesSection').style.display='none'; document.getElementById('newAddressForm').style.display='block'; document.getElementById('fullname').value=''; document.getElementById('mobile').value=''; document.getElementById('pincode').value=''; document.getElementById('city').value=''; document.getElementById('state').value=''; document.getElementById('house').value=''; document.getElementById('addressType').value='home'; }
    function editAddress(a){
      fillAddressForm(a); document.getElementById('savedAddressesSection').style.display='none'; document.getElementById('newAddressForm').style.display='block';
      let saveBtn=document.getElementById('saveUserInfo'); saveBtn.textContent='Update Address'; saveBtn.onclick=async()=>{
        let data={ name:document.getElementById('fullname').value, mobile:document.getElementById('mobile').value, pincode:document.getElementById('pincode').value, city:document.getElementById('city').value, state:document.getElementById('state').value, street:document.getElementById('house').value, type:document.getElementById('addressType').value };
        try{ await window.firebase.update(window.firebase.ref(window.firebase.database,'addresses/'+a.id),data); showToast('Address updated','success'); loadSavedAddresses(); } catch(e){ showToast('Failed to update','error'); }
      };
    }
    function deleteAddressConfirmation(a){
      document.getElementById('alertTitle').textContent='Delete Address'; document.getElementById('alertMessage').textContent=`Are you sure you want to delete address for ${a.name}?`; document.getElementById('alertModal').classList.add('active');
      document.getElementById('alertConfirmBtn').onclick=async()=>{ try{ await window.firebase.remove(window.firebase.ref(window.firebase.database,'addresses/'+a.id)); showToast('Address deleted','success'); document.getElementById('alertModal').classList.remove('active'); loadSavedAddresses(); } catch(e){ showToast('Failed to delete','error'); } };
    }
    async function saveUserInfoAndAddress(){
      let fn=document.getElementById('fullname').value, mb=document.getElementById('mobile').value, pin=document.getElementById('pincode').value, ct=document.getElementById('city').value, st=document.getElementById('state').value, hs=document.getElementById('house').value, type=document.getElementById('addressType').value;
      if(!fn||!mb||!pin||!ct||!st||!hs){ showToast('Please fill in all required fields','error'); return; }
      userInfo={ fullName:fn, mobile:mb, pincode:pin, city:ct, state:st, house:hs };
      let data={ name:fn, mobile:mb, pincode:pin, city:ct, state:st, street:hs, type, userId:currentUser.uid, isDefault:savedAddresses.length===0, createdAt:Date.now() };
      try{ await window.firebase.set(window.firebase.ref(window.firebase.database,'addresses/address_'+Date.now()),data); showToast('Address saved','success'); loadSavedAddresses(); } catch(e){ showToast('Failed to save','error'); }
    }

    // ================== AUTH & USER ==================
    function updateUIForUser(u){
      document.getElementById('userProfile').style.display='flex'; document.getElementById('openLoginTop').style.display='none'; document.getElementById('mobileLoginBtn').style.display='none'; document.getElementById('mobileUserProfile').style.display='flex'; document.getElementById('mobileLogoutBtn').style.display='flex';
      let img=document.getElementById('userAvatarImg'), init=document.getElementById('userAvatarInitial'), nameSpan=document.getElementById('headerUserNameShort');
      if(u.photoURL){ img.src=u.photoURL; img.style.display='block'; init.style.display='none'; } else { img.style.display='none'; init.style.display='block'; init.textContent=(u.displayName||'U').charAt(0).toUpperCase(); }
      let n=u.displayName||'User'; if(nameSpan){ let sn=n.split(' ')[0]; nameSpan.textContent=sn.length>10?sn.substring(0,10)+'...':sn; }
    }
    function updateUIForGuest(){
      document.getElementById('userProfile').style.display='none'; document.getElementById('openLoginTop').style.display='block'; document.getElementById('mobileLoginBtn').style.display='flex'; document.getElementById('mobileUserProfile').style.display='none'; document.getElementById('mobileLogoutBtn').style.display='none'; document.getElementById('openLoginTop').textContent='Login / Sign Up';
    }
    async function handleLogin(){ let e=document.getElementById('loginEmail').value, p=document.getElementById('loginPassword').value, err=document.getElementById('loginError'), btn=document.getElementById('loginBtn'); err.textContent=''; if(!e||!p){ err.textContent='Please fill in all fields'; return; } try{ btn.disabled=true; btn.innerHTML='<div class="loading-spinner"></div> Logging in...'; await window.firebase.signInWithEmailAndPassword(window.firebase.auth,e,p); showToast('Login successful!','success'); document.getElementById('authModal').classList.remove('active'); document.getElementById('loginEmail').value=''; document.getElementById('loginPassword').value=''; } catch(er){ err.textContent=er.message; } finally{ btn.disabled=false; btn.textContent='Login'; } }
    async function handleSignup(){ let n=document.getElementById('signupName').value, e=document.getElementById('signupEmail').value, p=document.getElementById('signupPassword').value, cp=document.getElementById('signupConfirmPassword').value, err=document.getElementById('signupError'), btn=document.getElementById('signupBtn'); err.textContent=''; if(!n||!e||!p||!cp){ err.textContent='Please fill in all fields'; return; } if(p!==cp){ err.textContent='Passwords do not match'; return; } if(p.length<6){ err.textContent='Password should be at least 6 characters'; return; } try{ btn.disabled=true; btn.innerHTML='<div class="loading-spinner"></div> Creating account...'; let cred=await window.firebase.createUserWithEmailAndPassword(window.firebase.auth,e,p); let user=cred.user; await window.firebase.set(window.firebase.ref(window.firebase.database,'users/'+user.uid),{ name:n, email:e, createdAt:Date.now(), lastLoginAt:Date.now() }); showToast('Account created successfully!','success'); document.getElementById('authModal').classList.remove('active'); document.getElementById('signupName').value=''; document.getElementById('signupEmail').value=''; document.getElementById('signupPassword').value=''; document.getElementById('signupConfirmPassword').value=''; } catch(er){ err.textContent=er.message; } finally{ btn.disabled=false; btn.textContent='Sign Up'; } }
    async function handleGoogleLogin(){ try{ let p=new window.firebase.GoogleAuthProvider(); let r=await window.firebase.signInWithPopup(window.firebase.auth,p); let u=r.user; let ref=window.firebase.ref(window.firebase.database,'users/'+u.uid); let snap=await window.firebase.get(ref); if(!snap.exists()) await window.firebase.set(ref,{ name:u.displayName, email:u.email, photoURL:u.photoURL, createdAt:Date.now(), lastLoginAt:Date.now() }); else await window.firebase.update(ref,{ lastLoginAt:Date.now() }); showToast('Login successful!','success'); document.getElementById('authModal').classList.remove('active'); } catch(er){ console.error(er); (document.getElementById('loginForm').classList.contains('active')?document.getElementById('loginError'):document.getElementById('signupError')).textContent=er.message; } }
    async function handleResetPassword(){ let e=document.getElementById('forgotPasswordEmail').value, btn=document.getElementById('resetPasswordBtn'); if(!e){ showToast('Please enter your email','error'); return; } try{ btn.disabled=true; btn.innerHTML='<div class="loading-spinner"></div> Sending...'; await window.firebase.sendPasswordResetEmail(window.firebase.auth,e); showToast('Password reset email sent!','success'); document.getElementById('forgotPasswordEmail').value=''; setTimeout(()=>document.getElementById('authModal').classList.remove('active'),2000); } catch(er){ showToast(er.message,'error'); } finally{ btn.disabled=false; btn.textContent='Send Reset Link'; } }

    // ================== DATA LOADING (ONLY FIREBASE) ==================
    async function fetchLiveData() {
      if(!window.firebase||!window.firebase.database) return;
      console.log('Fetching live data from Firebase...');
      let db=window.firebase.database, ref=window.firebase.ref, get=window.firebase.get;
      try{
        let prodSnap=await get(ref(db,'products')); if(prodSnap.exists()){ products=Object.keys(prodSnap.val()).map(k=>({id:k,...prodSnap.val()[k]})); cacheManager.set('products',products); renderProducts(products,'homeProductGrid'); renderProducts(products,'productGrid'); let trending=products.filter(p=>p.isTrending).slice(0,10); renderProductSlider(trending.length?trending:products.slice(0,10),'productSlider'); let featured=products.filter(p=>p.isFeatured); if(featured.length) renderProducts(featured,'homeProductGrid'); updateProductsCount(); }
        let catSnap=await get(ref(db,'categories')); if(catSnap.exists()){ categories=Object.keys(catSnap.val()).map(k=>({id:k,...catSnap.val()[k]})); cacheManager.set('categories',categories); renderCategories(); renderCategoryCircles(); }
        let banSnap=await get(ref(db,'banners')); if(banSnap.exists()){ banners=Object.keys(banSnap.val()).map(k=>({id:k,...banSnap.val()[k]})); cacheManager.set('banners',banners); renderBannerCarousel(); }
        let setSnap=await get(ref(db,'adminSettings')); if(setSnap.exists()){ adminSettings={...adminSettings,...setSnap.val()}; cacheManager.set('adminSettings',adminSettings); updateAdminSettingsUI(); }
      } catch(e){ console.error('Error fetching live data:',e); }
    }
    function loadCachedData(){
      let cp=cacheManager.get('products'); if(cp?.length){ products=cp; renderProducts(products,'homeProductGrid'); renderProducts(products,'productGrid'); let trending=products.filter(p=>p.isTrending).slice(0,10); renderProductSlider(trending.length?trending:products.slice(0,10),'productSlider'); let featured=products.filter(p=>p.isFeatured); if(featured.length) renderProducts(featured,'homeProductGrid'); updateProductsCount(); }
      let cc=cacheManager.get('categories'); if(cc?.length){ categories=cc; renderCategories(); renderCategoryCircles(); }
      let cb=cacheManager.get('banners'); if(cb?.length){ banners=cb; renderBannerCarousel(); }
      let cs=cacheManager.get('adminSettings'); if(cs){ adminSettings=cs; updateAdminSettingsUI(); }
    }
    function setupRealtimeListeners(){
      if(!window.firebase||!window.firebase.database) return;
      let db=window.firebase.database, ref=window.firebase.ref, onValue=window.firebase.onValue;
      onValue(ref(db,'products'), snap=>{ if(snap.exists()){ products=Object.keys(snap.val()).map(k=>({id:k,...snap.val()[k]})); cacheManager.set('products',products); if(document.querySelector('.page.active')?.id!=='searchResultsPage'){ renderProducts(products,'homeProductGrid'); renderProducts(products,'productGrid'); let trending=products.filter(p=>p.isTrending).slice(0,10); renderProductSlider(trending.length?trending:products.slice(0,10),'productSlider'); let featured=products.filter(p=>p.isFeatured); if(featured.length) renderProducts(featured,'homeProductGrid'); updateProductsCount(); } } });
      onValue(ref(db,'categories'), snap=>{ if(snap.exists()){ categories=Object.keys(snap.val()).map(k=>({id:k,...snap.val()[k]})); cacheManager.set('categories',categories); renderCategories(); renderCategoryCircles(); } });
      onValue(ref(db,'banners'), snap=>{ if(snap.exists()){ banners=Object.keys(snap.val()).map(k=>({id:k,...snap.val()[k]})); cacheManager.set('banners',banners); renderBannerCarousel(); } });
      onValue(ref(db,'adminSettings'), snap=>{ if(snap.exists()){ adminSettings={...adminSettings,...snap.val()}; cacheManager.set('adminSettings',adminSettings); updateAdminSettingsUI(); } });
    }
    function updateAdminSettingsUI(){ document.getElementById('deliveryCharge').textContent=adminSettings.deliveryCharge; document.getElementById('gatewayChargePercent').textContent=`${adminSettings.gatewayChargePercent}%`; }

    // ================== INIT ==================
    function initApp(){
      let savedTheme=localStorage.getItem('theme')||'light'; document.documentElement.setAttribute('data-theme',savedTheme);
      recentSearches=JSON.parse(localStorage.getItem('recentSearches')||'[]');
      setupEventListeners();
      window.firebase.onAuthStateChanged(window.firebase.auth, user=>{ if(user){ currentUser=user; updateUIForUser(user); loadUserData(user); loadRecentlyViewed(user); loadSavedAddresses(); document.getElementById('authModal')?.classList.remove('active'); } else { currentUser=null; updateUIForGuest(); } });
      loadCachedData(); fetchLiveData(); setupRealtimeListeners(); showPage('homePage'); setupHeroMessages(); updateBottomNav(); setupHeaderSearchScroll(); setupBackButton(); setupSearchInput();
    }
    function setupEventListeners(){
      document.getElementById('menuIcon')?.addEventListener('click',openMenu); document.getElementById('menuClose')?.addEventListener('click',closeMenu); document.getElementById('menuOverlay')?.addEventListener('click',closeMenu);
      document.getElementById('themeToggle')?.addEventListener('click',toggleTheme);
      document.getElementById('searchPanelClose')?.addEventListener('click',closeSearchPanel); document.getElementById('searchPanelInput')?.addEventListener('input',handleSearchPanelInput); document.getElementById('clearHistoryBtn')?.addEventListener('click',()=>{ recentSearches=[]; localStorage.setItem('recentSearches','[]'); loadRecentSearches(); }); document.getElementById('headerSearchInput')?.addEventListener('click',openSearchPanel);
      document.getElementById('authClose')?.addEventListener('click',()=>document.getElementById('authModal').classList.remove('active')); document.getElementById('openLoginTop')?.addEventListener('click',showLoginModal); document.getElementById('mobileLoginBtn')?.addEventListener('click',showLoginModal);
      document.getElementById('loginTab')?.addEventListener('click',()=>switchAuthTab('login')); document.getElementById('signupTab')?.addEventListener('click',()=>switchAuthTab('signup')); document.getElementById('switchToLogin')?.addEventListener('click',()=>switchAuthTab('login'));
      document.getElementById('loginBtn')?.addEventListener('click',handleLogin); document.getElementById('signupBtn')?.addEventListener('click',handleSignup); document.getElementById('googleLoginBtn')?.addEventListener('click',handleGoogleLogin); document.getElementById('googleSignupBtn')?.addEventListener('click',handleGoogleLogin);
      document.getElementById('forgotPasswordLink')?.addEventListener('click',()=>{ document.getElementById('loginForm').classList.remove('active'); document.getElementById('forgotPasswordForm').classList.add('active'); }); document.getElementById('backToLogin')?.addEventListener('click',()=>{ document.getElementById('forgotPasswordForm').classList.remove('active'); document.getElementById('loginForm').classList.add('active'); }); document.getElementById('resetPasswordBtn')?.addEventListener('click',handleResetPassword);
      document.getElementById('mobileLogoutBtn')?.addEventListener('click',showLogoutConfirmation);
      document.getElementById('alertCancelBtn')?.addEventListener('click',()=>document.getElementById('alertModal').classList.remove('active')); document.getElementById('alertConfirmBtn')?.addEventListener('click',confirmLogout);
      document.getElementById('zoomClose')?.addEventListener('click',()=>document.getElementById('zoomModal').classList.remove('active')); document.getElementById('zoomIn')?.addEventListener('click',()=>{ currentZoomLevel+=0.2; if(currentZoomLevel>3)currentZoomLevel=3; document.getElementById('zoomImage').style.transform=`scale(${currentZoomLevel})`; }); document.getElementById('zoomOut')?.addEventListener('click',()=>{ currentZoomLevel-=0.2; if(currentZoomLevel<0.5)currentZoomLevel=0.5; document.getElementById('zoomImage').style.transform=`scale(${currentZoomLevel})`; }); document.getElementById('zoomReset')?.addEventListener('click',()=>{ currentZoomLevel=1; document.getElementById('zoomImage').style.transform='scale(1)'; });
      document.getElementById('productImageModalClose')?.addEventListener('click',()=>document.getElementById('productImageModal').classList.remove('active')); document.getElementById('productImageModalPrev')?.addEventListener('click',prevProductModalImage); document.getElementById('productImageModalNext')?.addEventListener('click',nextProductModalImage);
      document.getElementById('backToProducts')?.addEventListener('click',()=>showPage('productsPage')); document.getElementById('toUserInfo')?.addEventListener('click',toUserInfo); document.getElementById('editOrder')?.addEventListener('click',()=>showPage('orderPage')); document.getElementById('toPayment')?.addEventListener('click',toPayment); document.getElementById('payBack')?.addEventListener('click',()=>showPage('userPage')); document.getElementById('confirmOrder')?.addEventListener('click',confirmOrder); document.getElementById('goHome')?.addEventListener('click',()=>showPage('homePage')); document.getElementById('viewOrders')?.addEventListener('click',()=>checkAuthAndShowPage('myOrdersPage'));
      document.querySelector('.qty-minus')?.addEventListener('click',decreaseQuantity); document.querySelector('.qty-plus')?.addEventListener('click',increaseQuantity);
      document.querySelectorAll('#sizeOptions .size-option').forEach(o=>{ o.addEventListener('click',function(){ document.querySelectorAll('#sizeOptions .size-option').forEach(opt=>opt.classList.remove('selected')); this.classList.add('selected'); document.getElementById('sizeValidationError')?.classList.remove('show'); }); });
      document.getElementById('applyPriceFilter')?.addEventListener('click',applyPriceFilter); document.getElementById('resetPriceFilter')?.addEventListener('click',resetPriceFilter);
      setupPriceSlider(document.getElementById('priceMinThumb'),document.getElementById('priceMaxThumb'),document.getElementById('priceSliderTrack'),document.getElementById('priceSliderRange'),document.getElementById('minPrice'),document.getElementById('maxPrice'));
      document.getElementById('subscribeBtn')?.addEventListener('click',()=>{ let e=document.getElementById('newsletterEmail').value; if(!e) showToast('Please enter email','error'); else { showToast('Thank you for subscribing!','success'); document.getElementById('newsletterEmail').value=''; } });
      document.getElementById('detailOrderBtn')?.addEventListener('click',orderProductFromDetail); document.getElementById('detailWishlistBtn')?.addEventListener('click',toggleWishlistFromDetail);
      document.querySelector('.detail-carousel-control.prev')?.addEventListener('click',prevDetailImage); document.querySelector('.detail-carousel-control.next')?.addEventListener('click',nextDetailImage);
      setupBannerTouchEvents();
      document.getElementById('ratingInput')?.querySelectorAll('.rating-star').forEach(s=>{ s.addEventListener('click',function(){ setRating(parseInt(this.getAttribute('data-rating'))); }); });
      document.getElementById('submitReview')?.addEventListener('click',submitProductReview);
      document.getElementById('copyShareLink')?.addEventListener('click',()=>{ let l=document.getElementById('productShareLink'); l.select(); document.execCommand('copy'); showToast('Link copied to clipboard','success'); });
      document.getElementById('saveUserInfo')?.addEventListener('click',saveUserInfoAndAddress);
      document.querySelectorAll('input[name="pay"]').forEach(r=>r.addEventListener('change',updatePaymentSummary));
      window.addEventListener('hashchange',function(){ let h=window.location.hash.substring(1); if(h&&document.getElementById(h)) showPage(h); });
      if(window.location.hash){ let pid=window.location.hash.substring(1); if(pid.startsWith('productDetailPage?product=')){ let prodId=pid.split('=')[1]; let prod=products.find(p=>p.id===prodId); if(prod) showProductDetail(prod); else showPage('homePage'); } else if(document.getElementById(pid)) showPage(pid); }
      let whatsapp=document.querySelector('a[href*="wa.me"]'); if(whatsapp) whatsapp.addEventListener('click',function(e){ e.preventDefault(); window.open(`https://wa.me/9557987574?text=${encodeURIComponent("Hello Buyzo Cart, I need help with my order üòÇ Please assist me with my query.")}`,'_blank'); });
      // Search results page input handler
      document.getElementById('searchResultsBtn')?.addEventListener('click',()=>{ let q=document.getElementById('searchResultsInput').value; if(q.trim()) performSearch(q); });
      document.getElementById('searchResultsInput')?.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); let q=e.target.value; if(q.trim()) performSearch(q); } });
    }
    function handleSearchPanelInput(e){ let q=e.target.value.trim(), sug=document.getElementById('searchSuggestions'); if(!sug)return; if(q.length>=1){ showSearchSuggestions(q); sug.style.display='block'; } else { sug.style.display='none'; } }
    function showSearchSuggestions(q){
      let sug=document.getElementById('searchSuggestions'); if(!sug)return;
      let suggs=products.filter(p=>p.name?.toLowerCase().includes(q.toLowerCase())||p.description?.toLowerCase().includes(q.toLowerCase())||p.category?.toLowerCase().includes(q.toLowerCase())||p.tags?.some(t=>t.toLowerCase().includes(q.toLowerCase()))).slice(0,10);
      sug.innerHTML=''; if(suggs.length===0){ sug.innerHTML='<div class="search-suggestion" style="justify-content:center;color:var(--muted)">No products found</div>'; return; }
      suggs.forEach(p=>{ let s=document.createElement('div'); s.className='search-suggestion'; s.innerHTML=`<div class="search-suggestion-img" style="background-image: url('${getProductImage(p)}')"></div><div class="search-suggestion-info"><div class="search-suggestion-name">${p.name}</div><div class="search-suggestion-price">‚Çπ${parsePrice(p.price).toLocaleString()}</div></div>`; s.addEventListener('click',()=>{ showProductDetail(p); closeSearchPanel(); }); sug.appendChild(s); });
    }
    function decreaseQuantity(){ let q=document.getElementById('qtySelect'); let v=parseInt(q.value); if(v>1) q.value=v-1; if(document.getElementById('paymentPage')?.classList.contains('active')) updatePaymentSummary(); }
    function increaseQuantity(){ let q=document.getElementById('qtySelect'); let v=parseInt(q.value); if(v<3) q.value=v+1; else showToast('Maximum 3 units per order','error'); if(document.getElementById('paymentPage')?.classList.contains('active')) updatePaymentSummary(); }
    function orderProductFromDetail(){
      if(!currentProduct) return;
      document.querySelectorAll('#sizeOptions .size-option').forEach(o=>o.classList.remove('selected'));
      document.getElementById('spTitle').textContent=currentProduct.name; document.getElementById('spPrice').textContent=currentProduct.price?'‚Çπ'+parsePrice(currentProduct.price).toLocaleString():'‚Çπ0'; document.getElementById('spDesc').textContent=currentProduct.description||''; document.getElementById('spFullDesc').textContent=currentProduct.fullDescription||currentProduct.description||'';
      initOrderPageGallery(); showPage('orderPage');
    }
    function setupPriceSlider(minT,maxT,track,range,minI,maxI){
      let minP=0,maxP=100, minPr=0,maxPr=10000;
      function upd(){ minT.style.left=minP+'%'; maxT.style.left=maxP+'%'; range.style.left=minP+'%'; range.style.width=(maxP-minP)+'%'; minI.value=Math.round(minPr+(minP/100)*(maxPr-minPr)); maxI.value=Math.round(minPr+(maxP/100)*(maxPr-minPr)); }
      function move(t,isMin){ return function(e){ e.preventDefault(); let rect=track.getBoundingClientRect(), pct=((e.type==='touchmove'?e.touches[0].clientX:e.clientX)-rect.left)/rect.width*100; pct=Math.max(0,Math.min(100,pct)); if(isMin && pct<maxP-5) minP=pct; if(!isMin && pct>minP+5) maxP=pct; upd(); }; }
      function up(){ document.removeEventListener('mousemove',mm); document.removeEventListener('mouseup',up); document.removeEventListener('touchmove',tm); document.removeEventListener('touchend',up); }
      let mm,tm;
      function down(isMin){ return function(e){ e.preventDefault(); mm=move(isMin?minT:maxT,isMin); tm=move(isMin?minT:maxT,isMin); document.addEventListener('mousemove',mm); document.addEventListener('mouseup',up); document.addEventListener('touchmove',tm); document.addEventListener('touchend',up); }; }
      minT.addEventListener('mousedown',down(true)); maxT.addEventListener('mousedown',down(false)); minT.addEventListener('touchstart',down(true)); maxT.addEventListener('touchstart',down(false));
      minI.addEventListener('input',function(){ let v=parseInt(this.value)||0; minP=((v-minPr)/(maxPr-minPr))*100; if(minP>=maxP-5) minP=maxP-5; upd(); });
      maxI.addEventListener('input',function(){ let v=parseInt(this.value)||maxPr; maxP=((v-minPr)/(maxPr-minPr))*100; if(maxP<=minP+5) maxP=minP+5; upd(); });
      upd();
    }
    function setupBannerTouchEvents(){
      let bc=document.getElementById('bannerCarousel'); if(!bc)return; let sx=0,ex=0,drg=false;
      bc.addEventListener('touchstart',(e)=>{ clearInterval(bannerAutoSlideInterval); sx=e.touches[0].clientX; drg=true; },{passive:true});
      bc.addEventListener('touchmove',(e)=>{ if(!drg)return; ex=e.touches[0].clientX; },{passive:true});
      bc.addEventListener('touchend',()=>{ if(!drg)return; let diff=sx-ex, act=Array.from(document.querySelectorAll('.banner-dot')).findIndex(d=>d.classList.contains('active')); if(Math.abs(diff)>50){ if(diff>0){ let nxt=(act+1)%banners.length; setBannerSlide(nxt); } else { let prv=(act-1+banners.length)%banners.length; setBannerSlide(prv); } } drg=false; setTimeout(setupBannerAutoSlide,3000); });
    }
    function setupBannerAutoSlide(){
      if(banners.length<=1)return; let idx=0; if(bannerAutoSlideInterval)clearInterval(bannerAutoSlideInterval); bannerAutoSlideInterval=setInterval(()=>{ idx=(idx+1)%banners.length; setBannerSlide(idx); },5000);
    }
    function setupHeroMessages(){ let m=document.querySelectorAll('#heroMessages span'); let i=0; setInterval(()=>{ m.forEach(msg=>msg.classList.remove('active')); i=(i+1)%m.length; m[i].classList.add('active'); },3000); }
    async function loadUserData(u){ try{ let s=await window.firebase.get(window.firebase.ref(window.firebase.database,'users/'+u.uid)); if(s.exists()) userInfo={...userInfo,...s.val()}; }catch(e){} }
    async function loadRecentlyViewed(u){ try{ let s=await window.firebase.get(window.firebase.ref(window.firebase.database,'recentlyViewed/'+u.uid)); recentlyViewed=s.exists()?Object.keys(s.val()):[]; if(recentlyViewed.length>0) renderRecentlyViewed(); }catch(e){} }
    function renderRecentlyViewed(){ let sec=document.getElementById('recentlyViewedSection'), sl=document.getElementById('recentlyViewedSlider'); if(!sec||!sl)return; let rp=products.filter(p=>recentlyViewed.includes(p.id)).slice(0,10); if(rp.length===0){ sec.style.display='none'; return; } sec.style.display='block'; renderProductSlider(rp,'recentlyViewedSlider'); }
    function addToRecentlyViewed(pid){ if(!currentUser)return; window.firebase.set(window.firebase.ref(window.firebase.database,'recentlyViewed/'+currentUser.uid+'/'+pid),Date.now()).catch(()=>{}); }
    function setupHeaderSearchScroll(){ let h=document.getElementById('headerSearchContainer'); if(!h)return; window.addEventListener('scroll',()=>{ h.style.opacity='1'; h.style.visibility='visible'; }); }
    function setupBackButton(){ window.addEventListener('popstate',(e)=>{ let c=document.querySelector('.page.active').id; if(c==='productDetailPage') showPage('productsPage'); else if(c==='orderPage'||c==='userPage'||c==='paymentPage'){ if(c==='paymentPage') showPage('userPage'); else if(c==='userPage') showPage('orderPage'); else if(c==='orderPage') showPage('productsPage'); } else showPage('homePage'); }); }
    function setupSearchInput(){ let si=document.getElementById('searchPanelInput'); if(si){ si.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); performSearch(e.target.value); } }); si.addEventListener('input',handleSearchPanelInput); } }
    function showCategories(){ filterByCategory('all'); }
    function prevProductModalImage(){ if(currentProductImages.length<=1)return; currentProductModalIndex=(currentProductModalIndex-1+currentProductImages.length)%currentProductImages.length; updateProductModalImage(); }
    function nextProductModalImage(){ if(currentProductImages.length<=1)return; currentProductModalIndex=(currentProductModalIndex+1)%currentProductImages.length; updateProductModalImage(); }
    function openProductImageModal(){ if(!currentProduct)return; currentProductModalIndex=currentImageIndex; updateProductModalImage(); document.getElementById('productImageModal').classList.add('active'); }
    function updateProductModalImage(){ let img=document.getElementById('productImageModalImage'), dots=document.getElementById('productImageModalDots'); if(!img||!dots)return; img.src=currentProductImages[currentProductModalIndex]; dots.innerHTML=''; currentProductImages.forEach((_,i)=>{ let d=document.createElement('div'); d.className=`product-image-modal-dot ${i===currentProductModalIndex?'active':''}`; d.addEventListener('click',()=>{ currentProductModalIndex=i; updateProductModalImage(); }); dots.appendChild(d); }); }

    // Make functions global
    window.showPage = showPage; window.checkAuthAndShowPage = checkAuthAndShowPage; window.closeMenu = closeMenu; window.showCategories = showCategories; window.filterByCategory = filterByCategory; window.showLoginModal = showLoginModal; window.openSearchPanel = openSearchPanel; window.closeSearchPanel = closeSearchPanel; window.performSearch = performSearch; window.addToRecentSearches = addToRecentSearches; window.showProductDetail = showProductDetail; window.toggleWishlist = toggleWishlist; window.shareProduct = shareProduct; window.orderProductFromDetail = orderProductFromDetail; window.toggleWishlistFromDetail = toggleWishlistFromDetail; window.submitProductReview = submitProductReview; window.copyShareLink = function(){ let l=document.getElementById('productShareLink'); l.select(); document.execCommand('copy'); showToast('Link copied to clipboard','success'); }; window.decreaseQuantity = decreaseQuantity; window.increaseQuantity = increaseQuantity; window.toUserInfo = toUserInfo; window.toPayment = toPayment; window.confirmOrder = confirmOrder; window.showNewAddressForm = showNewAddressForm; window.saveUserInfoAndAddress = saveUserInfoAndAddress; window.showMyOrders = showMyOrders; window.showOrderDetail = showOrderDetail; window.showLogoutConfirmation = showLogoutConfirmation; window.confirmLogout = confirmLogout; window.renderWishlist = renderWishlist; window.setRating = setRating; window.prevDetailImage = prevDetailImage; window.nextDetailImage = nextDetailImage; window.applyPriceFilter = applyPriceFilter; window.resetPriceFilter = resetPriceFilter; window.updateProductsCount = updateProductsCount; window.handleNewsletterSubscription = ()=>{ let e=document.getElementById('newsletterEmail').value; if(!e) showToast('Please enter email','error'); else { showToast('Thank you for subscribing!','success'); document.getElementById('newsletterEmail').value=''; } }; window.updatePaymentSummary = updatePaymentSummary; window.initApp = initApp;
  </script>
</body>
</html>