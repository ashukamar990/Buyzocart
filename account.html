<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Account - Buyzocart Shop</title>
  <meta name="description" content="Manage your Buyzo Cart account, orders, wishlist, and settings."/>
  <meta name="robots" content="noindex, follow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --muted: #64748b;
      --muted-light: #94a3b8;
      --success: #22c55e;
      --error: #ef4444;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.08);
      --ring: #dbeafe;
      --ink: #0f172a;
      --ink-2: #334155;
      --border: #e2e8f0;
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --card: #1e293b;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --muted: #94a3b8;
      --muted-light: #64748b;
      --success: #22c55e;
      --error: #ef4444;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.3);
      --ring: #1e3a8a;
      --ink: #f1f5f9;
      --ink-2: #cbd5e1;
      --border: #334155;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      transition: var(--transition);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Header */
    header {
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid var(--border);
      transition: var(--transition);
    }

    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
    }

    .brand {
      font-weight: 800;
      color: var(--ink);
      font-size: 20px;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .brand .chip {
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 14px;
    }

    .cta {
      display: flex;
      gap: 10px;
      position: relative;
      align-items: center;
    }

    .btn {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn.secondary {
      background: #f1f5f9;
      color: var(--ink-2);
    }

    .btn.secondary:hover {
      background: #e2e8f0;
      transform: translateY(-1px);
    }

    .btn.error {
      background: var(--error);
    }

    .btn.error:hover {
      background: #dc2626;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Theme Toggle Button */
    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.2s ease;
      color: var(--ink);
    }

    .theme-toggle:hover {
      background: var(--border);
    }

    .theme-toggle svg {
      width: 20px;
      height: 20px;
    }

    .theme-toggle .moon-icon {
      display: none;
    }

    [data-theme="dark"] .theme-toggle .sun-icon {
      display: none;
    }

    [data-theme="dark"] .theme-toggle .moon-icon {
      display: block;
    }

    /* Container */
    .container {
      max-width: 1100px;
      margin: 28px auto;
      padding: 0 20px;
      min-height: 70vh;
    }

    /* Pages */
    .page {
      display: none;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-panel {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      border: 1px solid var(--border);
      transition: var(--transition);
    }

    label {
      display: block;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--card);
      outline: none;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
      color: var(--ink);
    }

    input:focus, select:focus, textarea:focus {
      box-shadow: 0 0 0 3px var(--ring);
      border-color: var(--accent);
    }

    .row {
      display: flex;
      gap: 16px;
    }

    .col {
      flex: 1;
    }

    .center {
      text-align: center;
    }

    footer {
      margin-top: 48px;
      text-align: center;
      color: var(--muted);
      padding: 28px 0;
      border-top: 1px solid var(--border);
      transition: var(--transition);
    }

    /* User Profile */
    .user-profile {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      position: relative;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }
    
    .user-avatar-img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--ink);
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card);
      color: var(--ink);
      padding: 16px 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-hover);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      transform: translateX(-50%) translateY(-100px);
      opacity: 0;
      transition: all 0.3s ease;
      max-width: 90%;
      text-align: center;
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--error);
    }
    
    .toast-icon {
      font-size: 20px;
    }
    
    .toast.success .toast-icon {
      color: var(--success);
    }
    
    .toast.error .toast-icon {
      color: var(--error);
    }

    /* Alert Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .alert-modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-hover);
      max-width: 500px;
      width: 90%;
      text-align: center;
    }
    
    .alert-modal h3 {
      margin-top: 0;
      margin-bottom: 16px;
      color: var(--ink);
    }
    
    .alert-modal p {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .alert-modal .alert-icon {
      font-size: 48px;
      color: var(--error);
      margin-bottom: 16px;
    }
    
    .alert-modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    /* Account Page Styles */
    .account-page {
      padding: 20px;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      margin-bottom: 20px;
      color: var(--accent);
      font-weight: 600;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: var(--radius);
      background: #f1f5f9;
      transition: all 0.2s ease;
    }

    [data-theme="dark"] .back-button {
      background: #1e293b;
    }
    
    .back-button:hover {
      background: #e2e8f0;
      color: var(--accent-hover);
    }

    .account-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .account-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 700;
    }

    .account-avatar-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }

    .account-info h2 {
      margin: 0 0 4px 0;
      font-size: 24px;
    }

    .account-info p {
      margin: 0;
      color: var(--muted);
    }

    .account-menu {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .account-menu-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .account-menu-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      border-color: var(--accent);
    }

    .account-menu-item svg {
      width: 24px;
      height: 24px;
      color: var(--accent);
    }

    .account-menu-item span {
      font-weight: 600;
      font-size: 14px;
    }

    .account-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      border: 1px solid var(--border);
    }

    .account-section h3 {
      margin-top: 0;
      margin-bottom: 16px;
      color: var(--accent);
      font-size: 18px;
    }

    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .address-card {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s ease;
    }

    [data-theme="dark"] .address-card {
      background: #1e293b;
    }

    .address-card:hover {
      border-color: var(--accent);
    }

    .address-card.selected {
      border-color: var(--accent);
      background: var(--ring);
    }

    .address-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-info h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      font-weight: 600;
    }

    .setting-info p {
      margin: 0;
      color: var(--muted);
      font-size: 12px;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--accent);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* Logout Button */
    .logout-btn {
      background: var(--error);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .logout-btn:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }

    /* Professional Account Section Styles */
    .account-section.professional {
      border-left: 4px solid var(--accent);
    }

    .account-section.danger-zone {
      border-left: 4px solid var(--error);
      background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    }

    [data-theme="dark"] .account-section.danger-zone {
      background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Product Card Styles */
    .product-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      display: flex;
      gap: 16px;
      transition: all 0.2s ease;
    }

    .product-card:hover {
      box-shadow: var(--shadow-hover);
      border-color: var(--accent);
    }

    .product-image {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      object-fit: cover;
    }

    .product-info {
      flex: 1;
    }

    .product-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 16px;
    }

    .product-price {
      color: var(--accent);
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 8px;
    }

    .product-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 8px;
    }

    .star {
      color: #fbbf24;
    }

    .order-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.2s ease;
    }

    .order-card:hover {
      box-shadow: var(--shadow-hover);
      border-color: var(--accent);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .order-id {
      font-weight: 600;
      color: var(--accent);
    }

    .order-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .order-status.delivered {
      background: #dcfce7;
      color: #166534;
    }

    .order-status.processing {
      background: #fef3c7;
      color: #92400e;
    }

    .order-status.shipped {
      background: #dbeafe;
      color: #1e40af;
    }

    .order-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .order-item {
      display: flex;
      gap: 12px;
      margin-bottom: 8px;
    }

    .order-item-image {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
    }

    /* Login Activity Styles */
    .activity-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      transition: all 0.2s ease;
    }

    .activity-item:hover {
      background: var(--ring);
    }

    .activity-info {
      flex: 1;
    }

    .activity-time {
      font-size: 12px;
      color: var(--muted);
    }

    .activity-device {
      font-size: 12px;
      color: var(--accent);
      margin-top: 2px;
    }

    .activity-status {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      background: var(--success);
      color: white;
    }

    /* Change Password Modal Specific Styles */
    .change-password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .account-menu {
        grid-template-columns: 1fr;
      }

      .account-header {
        flex-direction: column;
        text-align: center;
      }

      .header-inner {
        flex-wrap: wrap;
      }

      .product-card {
        flex-direction: column;
      }

      .product-image {
        width: 100%;
        height: 200px;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0 16px;
      }
      
      .row {
        flex-direction: column;
      }

      .address-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand" onclick="window.location.href='index.html'">
        <span class="chip">BUYZO</span>
        <span>Cart</span>
      </div>
      <div class="cta">
        <!-- Theme Toggle Button -->
        <button class="theme-toggle" id="themeToggle" title="Toggle Light/Dark Mode">
          <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
        
        <button class="btn secondary" onclick="window.location.href='index.html'">Back to Home</button>
        <div class="user-profile" id="userProfile" style="display:none;">
          <div class="user-avatar" id="userAvatar">
            <img class="user-avatar-img" id="userAvatarImg" style="display:none;" />
            <span id="userAvatarInitial">U</span>
          </div>
          <div class="user-name" id="userName">User</div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Account Page -->
    <section class="page active" id="accountPage">
      <div class="account-page">
        <div class="back-button" onclick="window.location.href='index.html'">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Home
        </div>
        
        <div class="account-header">
          <div class="account-avatar" id="accountPageAvatar">
            <img class="account-avatar-img" id="accountPageAvatarImg" style="display:none;" />
            <span id="accountPageAvatarInitial">U</span>
          </div>
          <div class="account-info">
            <h2 id="accountPageName">User Name</h2>
            <p id="accountPageEmail">user@example.com</p>
          </div>
        </div>
        
        <div class="account-menu">
          <div class="account-menu-item" onclick="showPage('ordersPage')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <span>My Orders</span>
          </div>
          <div class="account-menu-item" onclick="showPage('wishlistPage')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span>Wishlist</span>
          </div>
          <div class="account-menu-item" onclick="showPage('addressPage')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>Addresses</span>
          </div>
          <div class="account-menu-item" onclick="showPage('settingsPage')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            <span>Settings</span>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Profile Information</h3>
          <div class="profile-form">
            <div>
              <label>Full Name</label>
              <input type="text" id="profileName" placeholder="Enter your full name">
            </div>
            <div>
              <label>Email Address</label>
              <input type="email" id="profileEmail" placeholder="Enter your email" readonly>
            </div>
            <div>
              <label>Phone Number</label>
              <input type="tel" id="profilePhone" placeholder="Enter your phone number">
            </div>
            <button class="btn" id="saveProfile">Save Changes</button>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Account Security</h3>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Change Password</h4>
              <p>Update your password regularly to keep your account secure</p>
            </div>
            <button class="btn secondary" id="changePasswordBtn">Change</button>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Two-Factor Authentication</h4>
              <p>Add an extra layer of security to your account</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="twoFactorToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Login Activity</h3>
          <p>Last login: <span id="lastLoginTime">Loading...</span></p>
          <button class="btn secondary" id="viewLoginActivity">View All Activity</button>
        </div>

        <!-- Logout Section -->
        <div class="account-section professional">
          <h3>Session</h3>
          <p>Sign out from your account on this device.</p>
          <button class="logout-btn" id="accountLogoutBtn" style="margin-top: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
          </button>
        </div>
        
        <div class="account-section danger-zone">
          <h3>Danger Zone</h3>
          <p>Once you delete your account, there is no going back. Please be certain.</p>
          <button class="btn error" id="deleteAccountBtn">Delete Account</button>
        </div>
      </div>
    </section>

    <!-- Settings Page -->
    <section class="page" id="settingsPage">
      <div class="account-page">
        <div class="back-button" onclick="showPage('accountPage')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Account
        </div>
        
        <h2>Settings</h2>
        
        <div class="account-section professional">
          <h3>Notifications</h3>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Email Notifications</h4>
              <p>Receive order updates and promotional emails</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="emailNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h4>SMS Notifications</h4>
              <p>Receive order updates via SMS</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="smsNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Push Notifications</h4>
              <p>Receive push notifications on your device</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="pushNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Privacy</h3>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Personalized Recommendations</h4>
              <p>Get product recommendations based on your browsing history</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="personalizedRecs" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Data Sharing</h4>
              <p>Allow us to use your data to improve our services</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="dataSharing" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Appearance</h3>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Dark Mode</h4>
              <p>Toggle between light and dark theme</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="darkModeToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Language</h4>
              <p>Select your preferred language</p>
            </div>
            <select id="languageSelect">
              <option value="en">English</option>
              <option value="hi">Hindi</option>
            </select>
          </div>
        </div>
        
        <div class="account-section professional">
          <h3>Preferences</h3>
          <div class="setting-item">
            <div class="setting-info">
              <h4>Currency</h4>
              <p>Select your preferred currency</p>
            </div>
            <select id="currencySelect">
              <option value="INR">Indian Rupee (‚Çπ)</option>
              <option value="USD">US Dollar ($)</option>
            </select>
          </div>
        </div>
        
        <button class="btn" id="saveSettings">Save Settings</button>
      </div>
    </section>

    <!-- Address Page -->
    <section class="page" id="addressPage">
      <div class="account-page">
        <div class="back-button" onclick="showPage('accountPage')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Account
        </div>
        
        <h2>My Addresses</h2>
        
        <div class="account-section professional">
          <h3>Saved Addresses</h3>
          <div id="savedAddresses">
            <!-- Address cards will be dynamically inserted here -->
          </div>
          <button class="btn" id="addNewAddress" style="margin-top: 16px;">Add New Address</button>
        </div>
        
        <div class="account-section professional" id="newAddressForm" style="display: none;">
          <h3>Add New Address</h3>
          <div class="profile-form">
            <div>
              <label>Full Name *</label>
              <input type="text" id="addressName" placeholder="Enter full name">
            </div>
            <div>
              <label>Mobile Number *</label>
              <input type="tel" id="addressMobile" placeholder="10-digit mobile number">
            </div>
            <div class="row">
              <div class="col">
                <label>Pincode *</label>
                <input type="text" id="addressPincode" placeholder="Pincode">
              </div>
              <div class="col">
                <label>City *</label>
                <input type="text" id="addressCity" placeholder="City">
              </div>
            </div>
            <div class="row">
              <div class="col">
                <label>State *</label>
                <input type="text" id="addressState" placeholder="State">
              </div>
              <div class="col">
                <label>Address Type</label>
                <select id="addressType">
                  <option value="home">Home</option>
                  <option value="work">Work</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
            <div>
              <label>House / Street *</label>
              <textarea id="addressStreet" placeholder="House no., Building, Street, Area" rows="3"></textarea>
            </div>
            <div class="row">
              <div class="col">
                <button class="btn" id="saveAddress">Save Address</button>
              </div>
              <div class="col">
                <button class="btn secondary" id="cancelAddAddress">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Wishlist Page -->
    <section class="page" id="wishlistPage">
      <div class="account-page">
        <div class="back-button" onclick="showPage('accountPage')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Account
        </div>
        
        <h2>My Wishlist</h2>
        
        <div class="account-section professional">
          <h3>Saved Products</h3>
          <div id="wishlistItems">
            <!-- Wishlist products will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Orders Page -->
    <section class="page" id="ordersPage">
      <div class="account-page">
        <div class="back-button" onclick="showPage('accountPage')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Account
        </div>
        
        <h2>My Orders</h2>
        
        <div class="account-section professional">
          <h3>Order History</h3>
          <div id="ordersList">
            <!-- Orders will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div style="max-width: 1100px; margin: 0 auto; padding: 0 20px;">
      <p style="color: var(--muted); margin-bottom: 16px;">
        &copy; 2024 Buyzo Cart. Your trusted online shopping destination.
      </p>
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 20px;">
        <a href="index.html" style="color: var(--accent);">Home</a>
        <a href="index.html#productsPage" style="color: var(--accent);">Products</a>
        <a href="contact.html" style="color: var(--accent);">Contact Us</a>
      </div>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <!-- Alert Modal -->
  <div class="modal-overlay" id="alertModal">
    <div class="alert-modal">
      <div class="alert-icon">‚ö†Ô∏è</div>
      <h3 id="alertTitle">Alert</h3>
      <p id="alertMessage">This is an alert message.</p>
      <div class="alert-modal-buttons">
        <button class="btn secondary" id="alertCancelBtn">Cancel</button>
        <button class="btn" id="alertConfirmBtn">Yes</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal-overlay" id="changePasswordModal">
    <div class="alert-modal">
      <div class="alert-icon">üîê</div>
      <h3>Change Password</h3>
      <p>We will send a password reset link to your email address. Click the link in the email to change your password.</p>
      <p><strong id="changePasswordEmail"></strong></p>
      <div class="alert-modal-buttons">
        <button class="btn secondary" id="cancelChangePassword">Cancel</button>
        <button class="btn" id="sendResetLink">Send Reset Link</button>
      </div>
    </div>
  </div>

  <!-- Login Activity Modal -->
  <div class="modal-overlay" id="loginActivityModal">
    <div class="alert-modal" style="max-width: 700px;">
      <div class="alert-icon">üìã</div>
      <h3>Login Activity</h3>
      <div class="activity-list" id="loginActivityList">
        <!-- Login activity items will be dynamically inserted here -->
      </div>
      <div class="alert-modal-buttons">
        <button class="btn secondary" id="closeLoginActivity">Close</button>
      </div>
    </div>
  </div>

  <!-- Firebase Configuration -->
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAeB7VzIxJaNYagUPoKd-kN5HXmLbS2-Vw",
      authDomain: "videomanager-23d98.firebaseapp.com",
      databaseURL: "https://videomanager-23d98-default-rtdb.firebaseio.com",
      projectId: "videomanager-23d98",
      storageBucket: "videomanager-23d98.firebasestorage.app",
      messagingSenderId: "847321523576",
      appId: "1:847321523576:web:bda3f5026e3e163603548d",
      measurementId: "G-YBSJ1KMPV4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const realtimeDb = firebase.database();
  </script>

  <!-- JavaScript -->
  <script>
    // Global variables
    let currentUser = null;
    let userInfo = {};

    // DOM Elements
    const themeToggle = document.getElementById('themeToggle');
    const toast = document.getElementById('toast');
    const userProfile = document.getElementById('userProfile');
    const userAvatar = document.getElementById('userAvatar');
    const userAvatarImg = document.getElementById('userAvatarImg');
    const userAvatarInitial = document.getElementById('userAvatarInitial');
    const userName = document.getElementById('userName');
    const accountLogoutBtn = document.getElementById('accountLogoutBtn');
    const alertModal = document.getElementById('alertModal');
    const alertCancelBtn = document.getElementById('alertCancelBtn');
    const alertConfirmBtn = document.getElementById('alertConfirmBtn');
    const alertTitle = document.getElementById('alertTitle');
    const alertMessage = document.getElementById('alertMessage');

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      initApp();
      setupEventListeners();
      
      // Check authentication state
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          updateUIForUser(user);
          loadUserData(user);
          recordLoginActivity(user);
        } else {
          // Redirect to index.html if not logged in
          window.location.href = 'index.html';
        }
      });
    });

    function initApp() {
      // Set initial theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      if (savedTheme === 'dark') {
        document.getElementById('darkModeToggle').checked = true;
      }
      
      // Show account page by default
      showPage('accountPage');
    }

    function setupEventListeners() {
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      
      // Dark mode toggle in settings
      document.getElementById('darkModeToggle')?.addEventListener('change', function() {
        toggleTheme();
      });
      
      // Logout button
      accountLogoutBtn.addEventListener('click', showLogoutConfirmation);
      
      // Alert modal buttons
      alertCancelBtn.addEventListener('click', () => {
        alertModal.classList.remove('active');
      });
      
      alertConfirmBtn.addEventListener('click', () => {
        alertModal.classList.remove('active');
        if (alertTitle.textContent === 'Logout Confirmation') {
          logout();
        } else if (alertTitle.textContent === 'Delete Account') {
          deleteAccount();
        }
      });
      
      // Account page buttons
      document.getElementById('saveProfile')?.addEventListener('click', saveProfile);
      document.getElementById('changePasswordBtn')?.addEventListener('click', showChangePasswordModal);
      document.getElementById('deleteAccountBtn')?.addEventListener('click', showDeleteAccountConfirmation);
      document.getElementById('saveSettings')?.addEventListener('click', saveSettings);
      
      // Address page buttons
      document.getElementById('addNewAddress')?.addEventListener('click', showNewAddressForm);
      document.getElementById('cancelAddAddress')?.addEventListener('click', hideNewAddressForm);
      document.getElementById('saveAddress')?.addEventListener('click', saveAddress);
      
      // View login activity
      document.getElementById('viewLoginActivity')?.addEventListener('click', showLoginActivityModal);
      
      // Change password modal buttons
      document.getElementById('cancelChangePassword')?.addEventListener('click', () => {
        document.getElementById('changePasswordModal').classList.remove('active');
      });
      
      document.getElementById('sendResetLink')?.addEventListener('click', sendPasswordResetEmail);
      
      // Close login activity modal
      document.getElementById('closeLoginActivity')?.addEventListener('click', () => {
        document.getElementById('loginActivityModal').classList.remove('active');
      });
      
      // Two-factor authentication toggle
      document.getElementById('twoFactorToggle')?.addEventListener('change', function() {
        if (this.checked) {
          showToast('Two-factor authentication enabled', 'success');
        } else {
          showToast('Two-factor authentication disabled', 'info');
        }
      });
    }

    // Page navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(pageId).classList.add('active');
      
      // Load specific data for certain pages
      if (pageId === 'addressPage') {
        loadAddresses();
      } else if (pageId === 'wishlistPage') {
        loadWishlist();
      } else if (pageId === 'ordersPage') {
        loadOrders();
      }
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    // Theme functions
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      // Update toggle in settings if it exists
      const darkModeToggle = document.getElementById('darkModeToggle');
      if (darkModeToggle) {
        darkModeToggle.checked = newTheme === 'dark';
      }
      
      showToast(`${newTheme === 'dark' ? 'Dark' : 'Light'} mode enabled`, 'success');
    }

    // Toast notification
    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = 'toast ' + type;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // User interface updates
    function updateUIForUser(user) {
      userProfile.style.display = 'flex';
      
      // Update profile with Google data
      updateUserProfile(user);
      
      // Load user data to display
      realtimeDb.ref('users/' + user.uid).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          userName.textContent = userData.name || user.displayName || 'User';
          
          // Update account page
          if (document.getElementById('accountPageName')) {
            document.getElementById('accountPageName').textContent = userData.name || user.displayName || 'User';
            document.getElementById('accountPageEmail').textContent = user.email;
            document.getElementById('profileName').value = userData.name || user.displayName || '';
            document.getElementById('profileEmail').value = user.email;
            document.getElementById('profilePhone').value = userData.phone || '';
            
            // Update last login time
            if (userData.lastLoginAt) {
              const lastLoginTime = new Date(userData.lastLoginAt).toLocaleString();
              document.getElementById('lastLoginTime').textContent = lastLoginTime;
            }
          }
        }
      });
    }

    // Function to update user profile with Google data
    function updateUserProfile(user) {
      // Update header avatar and name
      if (user.photoURL) {
        userAvatarImg.src = user.photoURL;
        userAvatarImg.style.display = 'block';
        userAvatarInitial.style.display = 'none';
      } else {
        userAvatarImg.style.display = 'none';
        userAvatarInitial.style.display = 'block';
        userAvatarInitial.textContent = (user.displayName || 'U').charAt(0).toUpperCase();
      }
      
      userName.textContent = user.displayName || 'User';
      
      // Update account page
      if (document.getElementById('accountPageAvatarImg')) {
        if (user.photoURL) {
          document.getElementById('accountPageAvatarImg').src = user.photoURL;
          document.getElementById('accountPageAvatarImg').style.display = 'block';
          document.getElementById('accountPageAvatarInitial').style.display = 'none';
        } else {
          document.getElementById('accountPageAvatarImg').style.display = 'none';
          document.getElementById('accountPageAvatarInitial').style.display = 'block';
          document.getElementById('accountPageAvatarInitial').textContent = (user.displayName || 'U').charAt(0).toUpperCase();
        }
        
        document.getElementById('accountPageName').textContent = user.displayName || 'User';
        document.getElementById('accountPageEmail').textContent = user.email;
      }
    }

    function loadUserData(user) {
      realtimeDb.ref('users/' + user.uid).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          userInfo = { ...userInfo, ...userData };
          
          // Update last login time in account page
          if (userData.lastLoginAt && document.getElementById('lastLoginTime')) {
            const lastLoginTime = new Date(userData.lastLoginAt).toLocaleString();
            document.getElementById('lastLoginTime').textContent = lastLoginTime;
          }
          
          // Load settings if they exist
          if (userData.settings) {
            loadUserSettings(userData.settings);
          }
        }
      }).catch(error => {
        console.error('Error loading user data:', error);
      });
    }

    function loadUserSettings(settings) {
      // Load notification settings
      if (settings.emailNotifications !== undefined) {
        document.getElementById('emailNotifications').checked = settings.emailNotifications;
      }
      if (settings.smsNotifications !== undefined) {
        document.getElementById('smsNotifications').checked = settings.smsNotifications;
      }
      if (settings.pushNotifications !== undefined) {
        document.getElementById('pushNotifications').checked = settings.pushNotifications;
      }
      if (settings.personalizedRecs !== undefined) {
        document.getElementById('personalizedRecs').checked = settings.personalizedRecs;
      }
      if (settings.dataSharing !== undefined) {
        document.getElementById('dataSharing').checked = settings.dataSharing;
      }
      if (settings.language) {
        document.getElementById('languageSelect').value = settings.language;
      }
      if (settings.currency) {
        document.getElementById('currencySelect').value = settings.currency;
      }
    }

    // Record login activity
    function recordLoginActivity(user) {
      const timestamp = Date.now();
      const activityId = 'activity_' + timestamp;
      const userAgent = navigator.userAgent;
      const deviceType = /Mobile/.test(userAgent) ? 'Mobile' : 'Desktop';
      
      // Save login activity
      realtimeDb.ref('loginActivity/' + user.uid + '/' + activityId).set({
        timestamp: timestamp,
        userAgent: userAgent,
        deviceType: deviceType,
        status: 'success'
      }).then(() => {
        // Update last login time in user data
        realtimeDb.ref('users/' + user.uid).update({
          lastLoginAt: timestamp
        });
      }).catch(error => {
        console.error('Error recording login activity:', error);
      });
    }

    // Account functions
    function saveProfile() {
      const name = document.getElementById('profileName').value;
      const phone = document.getElementById('profilePhone').value;
      
      if (!currentUser) return;
      
      realtimeDb.ref('users/' + currentUser.uid).update({
        name: name,
        phone: phone,
        updatedAt: Date.now()
      }).then(() => {
        showToast('Profile updated successfully', 'success');
        // Update UI
        userName.textContent = name;
        userAvatarInitial.textContent = name.charAt(0).toUpperCase();
      }).catch(error => {
        console.error('Error updating profile:', error);
        showToast('Failed to update profile', 'error');
      });
    }

    function showChangePasswordModal() {
      if (currentUser) {
        document.getElementById('changePasswordEmail').textContent = currentUser.email;
        document.getElementById('changePasswordModal').classList.add('active');
      }
    }

    function sendPasswordResetEmail() {
      if (currentUser) {
        auth.sendPasswordResetEmail(currentUser.email).then(() => {
          showToast('Password reset link sent to your email. Please check your inbox.', 'success');
          document.getElementById('changePasswordModal').classList.remove('active');
        }).catch(error => {
          console.error('Error sending reset email:', error);
          showToast('Failed to send reset email. ' + error.message, 'error');
        });
      }
    }

    function showDeleteAccountConfirmation() {
      alertTitle.textContent = 'Delete Account';
      alertMessage.textContent = 'Are you sure you want to delete your account? This action cannot be undone.';
      alertModal.classList.add('active');
    }

    function deleteAccount() {
      if (!currentUser) return;
      
      // In a real app, you would delete the user from Firebase Auth and Database
      // For security, this requires re-authentication
      showToast('Account deletion feature coming soon', 'info');
    }

    function saveSettings() {
      const emailNotifications = document.getElementById('emailNotifications').checked;
      const smsNotifications = document.getElementById('smsNotifications').checked;
      const pushNotifications = document.getElementById('pushNotifications').checked;
      const personalizedRecs = document.getElementById('personalizedRecs').checked;
      const dataSharing = document.getElementById('dataSharing').checked;
      const language = document.getElementById('languageSelect').value;
      const currency = document.getElementById('currencySelect').value;
      
      if (!currentUser) return;
      
      realtimeDb.ref('users/' + currentUser.uid + '/settings').set({
        emailNotifications,
        smsNotifications,
        pushNotifications,
        personalizedRecs,
        dataSharing,
        language,
        currency
      }).then(() => {
        showToast('Settings saved successfully', 'success');
      }).catch(error => {
        console.error('Error saving settings:', error);
        showToast('Failed to save settings', 'error');
      });
    }

    function showLoginActivityModal() {
      if (!currentUser) return;
      
      realtimeDb.ref('loginActivity/' + currentUser.uid).once('value')
        .then(snapshot => {
          const container = document.getElementById('loginActivityList');
          container.innerHTML = '';
          
          if (!snapshot.exists()) {
            container.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">No login activity found.</p>';
            return;
          }
          
          const activities = snapshot.val();
          const activityArray = Object.keys(activities).map(key => ({
            id: key,
            ...activities[key]
          }));
          
          // Sort by timestamp descending (newest first)
          activityArray.sort((a, b) => b.timestamp - a.timestamp);
          
          activityArray.forEach(activity => {
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
              <div class="activity-info">
                <div>${new Date(activity.timestamp).toLocaleString()}</div>
                <div class="activity-device">${activity.deviceType || 'Unknown Device'}</div>
              </div>
              <div class="activity-status">Successful</div>
            `;
            container.appendChild(activityItem);
          });
          
          document.getElementById('loginActivityModal').classList.add('active');
        })
        .catch(error => {
          console.error('Error loading login activity:', error);
          showToast('Failed to load login activity', 'error');
        });
    }

    // Wishlist functions
    function loadWishlist() {
      if (!currentUser) return;
      
      realtimeDb.ref('wishlist/' + currentUser.uid).once('value')
        .then(snapshot => {
          const container = document.getElementById('wishlistItems');
          container.innerHTML = '';
          
          if (!snapshot.exists()) {
            container.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">Your wishlist is empty.</p>';
            return;
          }
          
          const wishlist = snapshot.val();
          Object.keys(wishlist).forEach(productId => {
            const product = wishlist[productId];
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            productCard.innerHTML = `
              <img src="${product.image || 'https://via.placeholder.com/100x100?text=Product'}" alt="${product.name}" class="product-image">
              <div class="product-info">
                <div class="product-title">${product.name}</div>
                <div class="product-price">‚Çπ${product.price}</div>
                <div class="product-rating">
                  ${'‚òÖ'.repeat(Math.floor(product.rating || 4))}${'‚òÜ'.repeat(5 - Math.floor(product.rating || 4))}
                  <span style="color:var(--muted);font-size:12px;">(${product.rating || 4})</span>
                </div>
                <div class="address-actions">
                  <button class="btn secondary" onclick="removeFromWishlist('${productId}')">Remove</button>
                  <button class="btn" onclick="addToCart('${productId}')">Add to Cart</button>
                </div>
              </div>
            `;
            container.appendChild(productCard);
          });
        })
        .catch(error => {
          console.error('Error loading wishlist:', error);
          showToast('Failed to load wishlist', 'error');
        });
    }

    function removeFromWishlist(productId) {
      if (!currentUser) return;
      
      if (confirm('Are you sure you want to remove this item from wishlist?')) {
        realtimeDb.ref('wishlist/' + currentUser.uid + '/' + productId).remove()
          .then(() => {
            showToast('Removed from wishlist', 'success');
            loadWishlist();
          })
          .catch(error => {
            console.error('Error removing from wishlist:', error);
            showToast('Failed to remove from wishlist', 'error');
          });
      }
    }

    function addToCart(productId) {
      // This would normally add the product to cart
      showToast('Product added to cart!', 'success');
    }

    // Orders functions
    function loadOrders() {
      if (!currentUser) return;
      
      realtimeDb.ref('orders/' + currentUser.uid).once('value')
        .then(snapshot => {
          const container = document.getElementById('ordersList');
          container.innerHTML = '';
          
          if (!snapshot.exists()) {
            container.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">You have no orders yet.</p>';
            return;
          }
          
          const orders = snapshot.val();
          Object.keys(orders).forEach(orderId => {
            const order = orders[orderId];
            const orderCard = document.createElement('div');
            orderCard.className = 'order-card';
            
            // Determine status class
            let statusClass = 'processing';
            let statusText = 'Processing';
            if (order.status === 'delivered') {
              statusClass = 'delivered';
              statusText = 'Delivered';
            } else if (order.status === 'shipped') {
              statusClass = 'shipped';
              statusText = 'Shipped';
            }
            
            orderCard.innerHTML = `
              <div class="order-header">
                <div>
                  <div class="order-id">Order #${orderId.slice(-8)}</div>
                  <div style="font-size:12px;color:var(--muted);">Placed on ${new Date(order.timestamp).toLocaleDateString()}</div>
                </div>
                <div class="order-status ${statusClass}">${statusText}</div>
              </div>
              <div class="order-details">
                <div>
                  <div style="font-size:12px;color:var(--muted);">Total Amount</div>
                  <div style="font-weight:700;font-size:18px;">‚Çπ${order.total}</div>
                </div>
                <div>
                  <div style="font-size:12px;color:var(--muted);">Items</div>
                  <div style="font-weight:600;">${order.items ? Object.keys(order.items).length : 0} items</div>
                </div>
                <div>
                  <div style="font-size:12px;color:var(--muted);">Payment Method</div>
                  <div style="font-weight:600;">${order.paymentMethod || 'Credit Card'}</div>
                </div>
              </div>
              ${order.items ? `
                <div style="margin-top:16px;">
                  <div style="font-size:14px;font-weight:600;margin-bottom:8px;">Items:</div>
                  ${Object.keys(order.items).map(itemId => {
                    const item = order.items[itemId];
                    return `
                      <div class="order-item">
                        <img src="${item.image || 'https://via.placeholder.com/60x60?text=Product'}" alt="${item.name}" class="order-item-image">
                        <div>
                          <div style="font-weight:600;">${item.name}</div>
                          <div>Quantity: ${item.quantity}</div>
                          <div>‚Çπ${item.price} each</div>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              ` : ''}
              <div class="address-actions" style="margin-top:16px;">
                <button class="btn secondary" onclick="viewOrderDetails('${orderId}')">View Details</button>
                <button class="btn" onclick="reorder('${orderId}')">Reorder</button>
              </div>
            `;
            container.appendChild(orderCard);
          });
        })
        .catch(error => {
          console.error('Error loading orders:', error);
          showToast('Failed to load orders', 'error');
        });
    }

    function viewOrderDetails(orderId) {
      showToast(`Viewing details for order ${orderId.slice(-8)}`, 'info');
    }

    function reorder(orderId) {
      showToast(`Reordering items from order ${orderId.slice(-8)}`, 'success');
    }

    // Address functions
    function showNewAddressForm() {
      document.getElementById('savedAddresses').style.display = 'none';
      document.getElementById('newAddressForm').style.display = 'block';
      document.getElementById('addNewAddress').style.display = 'none';
      
      // Clear form
      document.getElementById('addressName').value = '';
      document.getElementById('addressMobile').value = '';
      document.getElementById('addressPincode').value = '';
      document.getElementById('addressCity').value = '';
      document.getElementById('addressState').value = '';
      document.getElementById('addressStreet').value = '';
    }

    function hideNewAddressForm() {
      document.getElementById('savedAddresses').style.display = 'block';
      document.getElementById('newAddressForm').style.display = 'none';
      document.getElementById('addNewAddress').style.display = 'block';
    }

    function saveAddress() {
      const name = document.getElementById('addressName').value;
      const mobile = document.getElementById('addressMobile').value;
      const pincode = document.getElementById('addressPincode').value;
      const city = document.getElementById('addressCity').value;
      const state = document.getElementById('addressState').value;
      const type = document.getElementById('addressType').value;
      const street = document.getElementById('addressStreet').value;
      
      if (!name || !mobile || !pincode || !city || !state || !street) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      
      if (!currentUser) return;
      
      const addressId = 'address_' + Date.now();
      
      realtimeDb.ref('addresses/' + addressId).set({
        userId: currentUser.uid,
        name: name,
        mobile: mobile,
        pincode: pincode,
        city: city,
        state: state,
        type: type,
        street: street,
        isDefault: false,
        createdAt: Date.now()
      }).then(() => {
        showToast('Address saved successfully', 'success');
        hideNewAddressForm();
        loadAddresses();
      }).catch(error => {
        console.error('Error saving address:', error);
        showToast('Failed to save address', 'error');
      });
    }

    function loadAddresses() {
      if (!currentUser) return;
      
      realtimeDb.ref('addresses').orderByChild('userId').equalTo(currentUser.uid)
        .once('value')
        .then(snapshot => {
          const container = document.getElementById('savedAddresses');
          container.innerHTML = '';
          
          if (!snapshot.exists()) {
            container.innerHTML = '<p style="color:var(--muted);text-align:center">No addresses saved yet</p>';
            return;
          }
          
          const addressesObj = snapshot.val();
          const addresses = Object.keys(addressesObj).map(key => ({
            id: key,
            ...addressesObj[key]
          }));
          
          // Sort by creation date
          addresses.sort((a, b) => b.createdAt - a.createdAt);
          
          addresses.forEach(address => {
            const addressCard = document.createElement('div');
            addressCard.className = 'address-card';
            addressCard.innerHTML = `
              <div style="font-weight:600">${address.name}</div>
              <div>${address.street}</div>
              <div>${address.city}, ${address.state} - ${address.pincode}</div>
              <div>Mobile: ${address.mobile}</div>
              <div class="address-actions">
                <button class="btn secondary edit-address" data-id="${address.id}">Edit</button>
                <button class="btn secondary delete-address" data-id="${address.id}">Delete</button>
              </div>
            `;
            
            // Add event listeners for edit and delete
            const editBtn = addressCard.querySelector('.edit-address');
            const deleteBtn = addressCard.querySelector('.delete-address');
            
            editBtn.addEventListener('click', () => editAddress(address));
            deleteBtn.addEventListener('click', () => deleteAddress(address.id));
            
            container.appendChild(addressCard);
          });
        })
        .catch(error => {
          console.error('Error loading addresses:', error);
          showToast('Failed to load addresses', 'error');
        });
    }

    function editAddress(address) {
      // Fill the form with address data
      document.getElementById('addressName').value = address.name;
      document.getElementById('addressMobile').value = address.mobile;
      document.getElementById('addressPincode').value = address.pincode;
      document.getElementById('addressCity').value = address.city;
      document.getElementById('addressState').value = address.state;
      document.getElementById('addressType').value = address.type;
      document.getElementById('addressStreet').value = address.street;
      
      // Show edit form
      showNewAddressForm();
      
      // Change save button to update
      const saveBtn = document.getElementById('saveAddress');
      saveBtn.textContent = 'Update Address';
      saveBtn.onclick = function() {
        updateAddress(address.id);
      };
    }

    function updateAddress(addressId) {
      const name = document.getElementById('addressName').value;
      const mobile = document.getElementById('addressMobile').value;
      const pincode = document.getElementById('addressPincode').value;
      const city = document.getElementById('addressCity').value;
      const state = document.getElementById('addressState').value;
      const type = document.getElementById('addressType').value;
      const street = document.getElementById('addressStreet').value;
      
      if (!name || !mobile || !pincode || !city || !state || !street) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      
      realtimeDb.ref('addresses/' + addressId).update({
        name: name,
        mobile: mobile,
        pincode: pincode,
        city: city,
        state: state,
        type: type,
        street: street,
        updatedAt: Date.now()
      }).then(() => {
        showToast('Address updated successfully', 'success');
        hideNewAddressForm();
        loadAddresses();
        
        // Reset save button
        const saveBtn = document.getElementById('saveAddress');
        saveBtn.textContent = 'Save Address';
        saveBtn.onclick = saveAddress;
      }).catch(error => {
        console.error('Error updating address:', error);
        showToast('Failed to update address', 'error');
      });
    }

    function deleteAddress(addressId) {
      if (confirm('Are you sure you want to delete this address?')) {
        realtimeDb.ref('addresses/' + addressId).remove()
          .then(() => {
            showToast('Address deleted successfully', 'success');
            loadAddresses();
          })
          .catch(error => {
            console.error('Error deleting address:', error);
            showToast('Failed to delete address', 'error');
          });
      }
    }

    // Logout function
    function showLogoutConfirmation() {
      alertTitle.textContent = 'Logout Confirmation';
      alertMessage.textContent = 'Are you sure you want to logout?';
      alertModal.classList.add('active');
    }

    function logout() {
      auth.signOut().then(() => {
        showToast('Logged out successfully', 'success');
        // Redirect to index.html
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1000);
      }).catch(error => {
        console.error('Logout error:', error);
        showToast('Error logging out', 'error');
      });
    }
  </script>
</body>
</html>